<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cotizador Botones y Brazaletes</title>
    <!-- Integración de Bootstrap para un diseño moderno -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
        }
        .container {
            max-width: 800px;
            margin-top: 30px;
        }
        .card {
            margin-bottom: 20px;
        }
        .card-header {
            background-color: #007bff;
            color: white;
        }
        .summary-card {
            border-left: 4px solid #198754;
        }
        .costs-summary-card {
            border-left: 4px solid #fd7e14;
        }
        .btn-danger {
            background-color: #dc3545;
        }
        h1, h2 {
            text-align: center;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>

        <div class="container">
        <h1>Cotizador Botones y Brazaletes</h1>
        <p class="text-center text-muted small">Creado por: Adrian Mtz 8341446103</p>
        
        <!-- =========== SECCIÓN COTIZADOR DE BOTONES =========== -->
        <div class="card">
            <div class="card-header">
                <h2>BOTON IMPRESOS A COLOR TIPO PIN MEDIDA 5.5 CM DIAMETRO</h2>
            </div>
            <div class="card-body">
                <div class="row align-items-end">
                    <div class="col-md-6">
                        <label for="cantidad_botones" class="form-label fw-bold">Cantidad a cotizar:</label>
                        <input type="number" class="form-control" id="cantidad_botones" min="1" placeholder="Escribe la cantidad...">
                    </div>
                    <div class="col-md-6 mt-3 mt-md-0">
                        <h4 class="text-end">Precio Unitario: <span id="precioUnitarioVenta_botones" class="badge bg-info">$0.00</span></h4>
                    </div>
                </div>

                <hr>

                <div class="mt-4">
                    <fieldset class="form-group">
                        <legend class="col-form-label col-sm-4 pt-0 fw-bold">Costo de Diseño:</legend>
                        <div id="opcionesDiseno_botones">
                            <div class="form-check"><input class="form-check-input" type="radio" name="costoDiseno_botones" value="50" data-label="Cliente envía diseño"><label class="form-check-label">Cliente envía diseño ($50.00)</label></div>
                            <div class="form-check"><input class="form-check-input" type="radio" name="costoDiseno_botones" value="215.52" data-label="Realizar diseño"><label class="form-check-label">Realizar diseño ($215.52)</label></div>
                            <div class="form-check"><input class="form-check-input" type="radio" name="costoDiseno_botones" value="150" data-label="Diseño guardado"><label class="form-check-label">Diseño guardado ($150.00)</label></div>
                        </div>
                    </fieldset>
                </div>

                <hr>

                <div class="row mt-4">
                    <div class="col-md-7">
                        <h4>Resultado de la Cotización (Botones):</h4>
                        <ul class="list-group">
                            <li class="list-group-item d-flex justify-content-between align-items-center">Subtotal (Botones):<span id="subtotal_botones" class="fw-bold">$0.00</span></li>
                            <li class="list-group-item d-flex justify-content-between align-items-center">Costo de Diseño:<span id="costoDisenoTotal_botones" class="fw-bold">$0.00</span></li>
                            <li class="list-group-item d-flex justify-content-between align-items-center">IVA (16%):<span id="iva_botones" class="fw-bold">$0.00</span></li>
                            <li class="list-group-item d-flex justify-content-between align-items-center fs-5"><strong>Total:</strong><strong id="total_botones" class="text-success">$0.00</strong></li>
                            <li class="list-group-item d-flex justify-content-between align-items-center">Costo Unitario (sin IVA):<span id="costoUnitarioSinIva_botones" class="fw-bold">$0.00</span></li>
                            <li class="list-group-item d-flex justify-content-between align-items-center">Costo Unitario (Neto):<span id="costoUnitarioNeto_botones" class="fw-bold">$0.00</span></li>
                        </ul>
                    </div>
                    <div class="col-md-5 mt-4 mt-md-0">
                        <div class="card costs-summary-card">
                            <div class="card-header bg-warning text-dark">Resumen de Costos (Interno)</div>
                            <div class="card-body small">
                                <p><strong>Hojas a usar:</strong> <span id="cantidadHojas_botones" class="fw-bold">0</span></p>
                                <p><strong>Utilidad aplicada:</strong> <span id="utilidadAplicada_botones" class="fw-bold">N/A</span></p>
                                <p><strong>Costo Botones:</strong><br><span id="detalleCostoBase_botones"></span><span id="costoBaseTotal_botones" class="fw-bold">$0.00</span></p>
                                <p><strong>Costo Impresión:</strong><br><span id="detalleCostoImpresion_botones"></span><span id="costoImpresionTotal_botones" class="fw-bold">$0.00</span></p>
                                <p><strong>Costo Corte:</strong><br><span id="detalleCostoCorte_botones"></span><span id="costoCorteTotal_botones" class="fw-bold">$0.00</span></p>
                                <hr>
                                <p><strong>Costo Total Producción:</strong> <strong id="costoProduccionTotal_botones">$0.00</strong></p>
                                <p class="mt-2"><strong>Utilidad Bruta (Botones):</strong> <strong id="utilidadBruta_botones" class="text-success">$0.00</strong></p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="d-grid gap-2 mt-4"><button id="limpiar_botones" class="btn btn-danger">Limpiar Campos de Botones</button></div>
            </div>
        </div>

        <div class="card summary-card">
            <div class="card-header bg-success">Resumen Simplificado (Botones)</div>
            <div class="card-body">
                <textarea id="resumenCliente_botones" class="form-control" rows="4" readonly></textarea>
                <div class="d-grid gap-2 mt-3"><button id="copiar_botones" class="btn btn-primary">Copiar Resumen de Botones</button></div>
            </div>
        </div>

        <!-- =========== SECCIÓN COTIZADOR DE BRAZALETES =========== -->
        <div class="card mt-5">
            <div class="card-header bg-info text-dark">
                <h1 style="font-size: 5rem;">Brazaletes</h1>
            </div>
            <div class="card-body">
                <div class="row align-items-end">
                    <div class="col-md-6">
                        <label class="form-label fw-bold">Tipo de Brazalete:</label>
                        <div id="tipo_brazalete">
                            <div class="form-check"><input class="form-check-input" type="radio" name="tipoBrazalete" value="papel" checked><label class="form-check-label">Papel 3/4"</label></div>
                            <div class="form-check"><input class="form-check-input" type="radio" name="tipoBrazalete" value="plastico"><label class="form-check-label">Plástico</label></div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label fw-bold">Impresión:</label>
                        <div id="tipo_impresion">
                            <div class="form-check"><input class="form-check-input" type="radio" name="tipoImpresion" value="con_impresion" checked><label class="form-check-label">Con impresión</label></div>
                            <div class="form-check"><input class="form-check-input" type="radio" name="tipoImpresion" value="sin_impresion"><label class="form-check-label">Sin impresión</label></div>
                        </div>
                    </div>
                </div>

                <div class="row align-items-end mt-3">
                    <div class="col-md-6">
                        <label for="cantidad_brazaletes" class="form-label fw-bold">Cantidad a cotizar:</label>
                        <input type="number" class="form-control" id="cantidad_brazaletes" min="1" placeholder="Escribe la cantidad...">
                    </div>
                    <div class="col-md-6 mt-3 mt-md-0">
                        <h4 class="text-end">Precio Unitario Aplicado: <span id="precioUnitarioVenta_brazaletes" class="badge bg-info">$0.00</span></h4>
                    </div>
                </div>

                <hr>

                <div class="row mt-4">
                    <div class="col-md-6">
                        <fieldset class="form-group">
                            <legend class="col-form-label pt-0 fw-bold">Costo de Diseño:</legend>
                            <div id="opcionesDiseno_brazaletes">
                                <div class="form-check"><input class="form-check-input" type="radio" name="costoDiseno_brazaletes" value="50" data-label="Cliente envía diseño"><label class="form-check-label">Cliente envía diseño ($50.00)</label></div>
                                <div class="form-check
                                "><input class="form-check-input" type="radio" name="costoDiseno_brazaletes" value="215.52" data-label="Realizar diseño"><label class="form-check-label">Realizar diseño ($215.52)</label></div>
                                <div class="form-check"><input class="form-check-input" type="radio" name="costoDiseno_brazaletes" value="150" data-label="Diseño guardado"><label class="form-check-label">Diseño guardado ($150.00)</label></div>
                            </div>
                        </fieldset>
                    </div>
                    <div class="col-md-6">
                        <fieldset class="form-group">
                            <legend class="col-form-label pt-0 fw-bold">¿Los tenemos en stock?</legend>
                            <div id="stock_brazalete">
                                <div class="form-check"><input class="form-check-input" type="radio" name="stockBrazalete" value="si" checked><label class="form-check-label">Sí (sin costo extra)</label></div>
                                <div class="form-check"><input class="form-check-input" type="radio" name="stockBrazalete" value="no"><label class="form-check-label">No (+$300.00 paquetería)</label></div>
                            </div>
                        </fieldset>
                    </div>
                </div>

                <hr>

                <div class="d-grid gap-2 mb-3">
                    <button class="btn btn-secondary" type="button" data-bs-toggle="collapse" data-bs-target="#desgloseBrazaletes" aria-expanded="false" aria-controls="desgloseBrazaletes">
                        Ver/Ocultar Desglose de Cálculo
                    </button>
                </div>

                <div class="collapse" id="desgloseBrazaletes">
                    <!-- PASO 1: CÁLCULO DE COSTOS DE PRODUCCIÓN -->
                    <div class="card costs-summary-card mb-4">
                        <div class="card-header bg-warning text-dark">
                            <h4>Paso 1: Calcular Costos de Producción (Uso Interno)</h4>
                        </div>
                        <div class="card-body small">
                            <p><strong>Utilidad aplicada:</strong> <span id="utilidadAplicada_brazaletes" class="fw-bold">N/A</span></p>
                            <p><strong>Costo Brazaletes (+10):</strong><br><span id="detalleCostoBase_brazaletes"></span><span id="costoBaseTotal_brazaletes" class="fw-bold">$0.00</span></p>
                            <small class="form-text text-muted">(Cantidad de brazaletes + 10 de merma) x Costo unitario de material.</small>
                            <p class="mt-2"><strong>Costo Marco:</strong> <span id="costoMarco_brazaletes" class="fw-bold">$0.00</span></p>
                            <small class="form-text text-muted">Costo fijo para la preparación del marco de serigrafía (solo si se elige 'Con impresión').</small>
                            <p class="mt-2"><strong>Costo Impresión:</strong> <span id="costoImpresionTotal_brazaletes" class="fw-bold">$0.00</span></p>
                            <small class="form-text text-muted">Costo variable de la tinta y el proceso de impresión (solo si se elige 'Con impresión').</small>
                            <hr>
                            <p><strong>Costo Total Producción:</strong> <strong id="costoProduccionTotal_brazaletes">$0.00</strong></p>
                            <small class="form-text text-muted">La suma de todos los costos anteriores. Esto es lo que nos cuesta producir los brazaletes.</small>
                            <p class="mt-2"><strong>Utilidad Bruta (Brazaletes):</strong> <strong id="utilidadBruta_brazaletes" class="text-success">$0.00</strong></p>
                            <small class="form-text text-muted">La ganancia antes de otros gastos. Se calcula: Subtotal de Venta - Costo Total de Producción (del Paso 1).</small>
                        </div>
                    </div>

                    <!-- PASO 2: CÁLCULO DEL PRECIO DE VENTA AL CLIENTE -->
                    <div class="card summary-card">
                        <div class="card-header bg-success text-white">
                            <h4>Paso 2: Calcular Precio de Venta al Cliente</h4>
                        </div>
                        <div class="card-body">
                            <h5>Tablas de Precios por Cantidad:</h5>
                            <div class="row">
                                <div class="col-md-6">
                                    <table class="table table-sm table-bordered">
                                        <thead><tr><th colspan="2">Papel 3/4"</th></tr><tr><th>Cantidad</th><th>Precio Unitario</th></tr></thead>
                                        <tbody>
                                            <tr><td>1 - 100</td><td>$9.80</td></tr>
                                            <tr><td>101 - 200</td><td>$8.40</td></tr>
                                            <tr><td>201 - 300</td><td>$7.00</td></tr>
                                            <tr><td>301 - 500</td><td>$5.60</td></tr>
                                            <tr><td>501+</td><td>$4.90</td></tr>
                                        </tbody>
                                    </table>
                                </div>
                                <div class="col-md-6">
                                    <table class="table table-sm table-bordered">
                                        <thead><tr><th colspan="2">Plástico</th></tr><tr><th>Cantidad</th><th>Precio Unitario</th></tr></thead>
                                        <tbody>
                                            <tr><td>1 - 100</td><td>$21.00</td></tr>
                                            <tr><td>101 - 200</td><td>$14.00</td></tr>
                                            <tr><td>201 - 300</td><td>$12.25</td></tr>
                                            <tr><td>301 - 500</td><td>$10.50</td></tr>
                                            <tr><td>501+</td><td>$8.75</td></tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                                                    <hr>
                                                    <div id="infoDescuentoSinImpresion" class="alert alert-info small" style="display: none;">
                                                        <strong>Desglose de Descuento (Sin Impresión):</strong>
                                                        <ul class="mb-0">
                                                            <li>Precio Unitario Original: <span id="precioOriginalSinImpresion" class="fw-bold"></span></li>
                                                            <li>Descuento Aplicado: <span id="porcentajeDescuento" class="fw-bold"></span></li>
                                                            <li>Monto del Descuento: <span id="montoDescuento" class="fw-bold"></span></li>
                                                            <li>Precio Unitario con Descuento: <span id="precioFinalConDescuento" class="fw-bold"></span></li>
                                                        </ul>
                                                    </div>
                                                    <ul class="list-group">
                                                        <li class="list-group-item d-flex justify-content-between align-items-center">Subtotal (Brazaletes):<span id="subtotal_brazaletes" class="fw-bold">$0.00</span></li>
                                                        <small id="explicacionSubtotalBrazaletes" class="form-text text-muted ps-3">Se multiplica la cantidad de brazaletes por el 'Precio de Venta Unitario' que corresponde según la tabla de precios de arriba.</small>
                                                        <li class="list-group-item d-flex justify-content-between align-items-center">Costo de Diseño:<span id="costoDisenoTotal_brazaletes" class="fw-bold">$0.00</span></li>                                <li class="list-group-item d-flex justify-content-between align-items-center">Costo de Paquetería:<span id="costoPaqueteria_brazaletes" class="fw-bold">$0.00</span></li>
                                <li class="list-group-item d-flex justify-content-between align-items-center">IVA (16%):<span id="iva_brazaletes" class="fw-bold">$0.00</span></li>
                                <small class="form-text text-muted ps-3">Se calcula el 16% sobre la suma del Subtotal, el Costo de Diseño y el Costo de Paquetería.</small>
                                <li class="list-group-item d-flex justify-content-between align-items-center fs-5"><strong>Total:</strong><strong id="total_brazaletes" class="text-success">$0.00</strong></li>
                                <small class="form-text text-muted ps-3">La suma final de Subtotal + Diseño + Paquetería + IVA. Es el monto total que paga el cliente.</small>
                                <li class="list-group-item d-flex justify-content-between align-items-center">Costo Unitario (sin IVA):<span id="costoUnitarioSinIva_brazaletes" class="fw-bold">$0.00</span></li>
                                <small class="form-text text-muted ps-3">Precio de Venta por unidad antes de impuestos.</small>
                                <li class="list-group-item d-flex justify-content-between align-items-center">Costo Unitario (con IVA):<span id="costoUnitarioNeto_brazaletes" class="fw-bold">$0.00</span></li>
                                <small class="form-text text-muted ps-3">Total / Cantidad de brazaletes.</small>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="d-grid gap-2 mt-4"><button id="limpiar_brazaletes" class="btn btn-danger">Limpiar Campos de Brazaletes</button></div>
            </div>
        </div>

        <div class="card summary-card">
            <div class="card-header bg-success">Resumen Simplificado (Brazaletes)</div>
            <div class="card-body">
                <textarea id="resumenCliente_brazaletes" class="form-control" rows="4" readonly></textarea>
                <div class="d-grid gap-2 mt-3"><button id="copiar_brazaletes" class="btn btn-primary">Copiar Resumen de Brazaletes</button></div>
            </div>
        </div>

    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
// --- UTILIDADES GENERALES ---
function formatoMoneda(numero) {
    return new Intl.NumberFormat('es-MX', { style: 'currency', currency: 'MXN' }).format(numero);
}

// ====================================================================
// =========== LÓGICA DEL COTIZADOR DE BOTONES ========================
// ====================================================================
{
    const cantidadInput = document.getElementById('cantidad_botones');
    const opcionesDisenoEl = document.getElementById('opcionesDiseno_botones');
    const precioUnitarioVentaEl = document.getElementById('precioUnitarioVenta_botones');
    const subtotalEl = document.getElementById('subtotal_botones');
    const costoDisenoTotalEl = document.getElementById('costoDisenoTotal_botones');
    const ivaEl = document.getElementById('iva_botones');
    const totalEl = document.getElementById('total_botones');
    const costoUnitarioNetoEl = document.getElementById('costoUnitarioNeto_botones');
    const costoUnitarioSinIvaEl = document.getElementById('costoUnitarioSinIva_botones');
    const cantidadHojasEl = document.getElementById('cantidadHojas_botones');
    const utilidadAplicadaEl = document.getElementById('utilidadAplicada_botones');
    const costoBaseTotalEl = document.getElementById('costoBaseTotal_botones');
    const costoImpresionTotalEl = document.getElementById('costoImpresionTotal_botones');
    const costoCorteTotalEl = document.getElementById('costoCorteTotal_botones');
    const costoProduccionTotalEl = document.getElementById('costoProduccionTotal_botones');
    const utilidadBrutaEl = document.getElementById('utilidadBruta_botones');
    const detalleCostoBaseEl = document.getElementById('detalleCostoBase_botones');
    const detalleCostoImpresionEl = document.getElementById('detalleCostoImpresion_botones');
    const detalleCostoCorteEl = document.getElementById('detalleCostoCorte_botones');
    const resumenClienteEl = document.getElementById('resumenCliente_botones');
    const limpiarBtn = document.getElementById('limpiar_botones');
    const copiarBtn = document.getElementById('copiar_botones');

    const COSTO_BASE_BOTON = 3.63;
    const COSTO_HOJA_IMPRESION = 7.50;
    const COSTO_HOJA_CORTE = 18.00;
    const BOTONES_POR_HOJA = 8;
    const IVA_PERCENT = 0.16;

    function getPrecioVentaUnitario(cantidad) {
        if (cantidad >= 1 && cantidad <= 10) return 18.15;
        if (cantidad >= 11 && cantidad <= 20) return 16.335;
        if (cantidad >= 21 && cantidad <= 50) return 14.52;
        if (cantidad >= 51 && cantidad <= 100) return 12.705;
        if (cantidad >= 101 && cantidad <= 200) return 10.89;
        if (cantidad >= 201) return 9.075;
        return 0;
    }

    function getUtilidadMultiplicador(cantidad) {
        if (cantidad >= 1 && cantidad <= 10) return "x5";
        if (cantidad >= 11 && cantidad <= 20) return "x4.5";
        if (cantidad >= 21 && cantidad <= 50) return "x4";
        if (cantidad >= 51 && cantidad <= 100) return "x3.5";
        if (cantidad >= 101 && cantidad <= 200) return "x3";
        if (cantidad >= 201) return "x2.5";
        return "N/A";
    }

    function cotizar() {
        const cantidad = parseInt(cantidadInput.value, 10) || 0;
        const opcionDisenoSeleccionada = document.querySelector('input[name="costoDiseno_botones"]:checked');
        const costoDiseno = opcionDisenoSeleccionada ? parseFloat(opcionDisenoSeleccionada.value) : 0;
        const etiquetaDiseno = opcionDisenoSeleccionada ? opcionDisenoSeleccionada.dataset.label : "";

        if (cantidad <= 0) {
            limpiarCampos();
            return;
        }

        const precioVentaUnitario = getPrecioVentaUnitario(cantidad);
        const subtotalBotones = cantidad * precioVentaUnitario;
        const subtotalGeneral = subtotalBotones + costoDiseno;
        const iva = subtotalGeneral * IVA_PERCENT;
        const total = subtotalGeneral + iva;
        const costoUnitarioNeto = total / cantidad;

        const hojasNecesarias = Math.ceil(cantidad / BOTONES_POR_HOJA);
        const costoBaseTotal = cantidad * COSTO_BASE_BOTON;
        const costoImpresionTotal = hojasNecesarias * COSTO_HOJA_IMPRESION;
        const costoCorteTotal = hojasNecesarias * COSTO_HOJA_CORTE;
        const costoProduccionTotal = costoBaseTotal + costoImpresionTotal + costoCorteTotal;
        const multiplicador = getUtilidadMultiplicador(cantidad);
        const utilidadBruta = subtotalBotones - costoProduccionTotal;

        precioUnitarioVentaEl.textContent = formatoMoneda(precioVentaUnitario);
        subtotalEl.textContent = formatoMoneda(subtotalBotones);
        costoDisenoTotalEl.textContent = formatoMoneda(costoDiseno);
        ivaEl.textContent = formatoMoneda(iva);
        totalEl.textContent = formatoMoneda(total);
        costoUnitarioNetoEl.textContent = formatoMoneda(costoUnitarioNeto);
        costoUnitarioSinIvaEl.textContent = formatoMoneda(precioVentaUnitario);

        cantidadHojasEl.textContent = hojasNecesarias;
        utilidadAplicadaEl.textContent = multiplicador;
        detalleCostoBaseEl.textContent = `(${cantidad} pz x ${formatoMoneda(COSTO_BASE_BOTON)}) = `;
        costoBaseTotalEl.textContent = formatoMoneda(costoBaseTotal);
        detalleCostoImpresionEl.textContent = `(${hojasNecesarias} hojas x ${formatoMoneda(COSTO_HOJA_IMPRESION)}) = `;
        costoImpresionTotalEl.textContent = formatoMoneda(costoImpresionTotal);
        detalleCostoCorteEl.textContent = `(${hojasNecesarias} cortes x ${formatoMoneda(COSTO_HOJA_CORTE)}) = `;
        costoCorteTotalEl.textContent = formatoMoneda(costoCorteTotal);
        costoProduccionTotalEl.textContent = formatoMoneda(costoProduccionTotal);
        utilidadBrutaEl.textContent = formatoMoneda(utilidadBruta);
        
        generarResumenCliente(cantidad, costoUnitarioNeto, total, costoDiseno, etiquetaDiseno);
    }

    function generarResumenCliente(cantidad, costoUnitarioFinal, total, costoDiseno, etiquetaDiseno) {
        const nombreProducto = "Boton impresos a color tipo pin medida 5.5 cm diametro";
        let resumen = `Hola, te comparto la cotización: ${cantidad} pz de ${nombreProducto}, precio unitario: ${formatoMoneda(costoUnitarioFinal)}, total a pagar: ${formatoMoneda(total)} (IVA incluido).`;
        if (costoDiseno > 0) {
            resumen += ` ${etiquetaDiseno}.`;
        }
        resumenClienteEl.value = resumen;
    }

    function limpiarCampos() {
        cantidadInput.value = '';
        const opcionDisenoSeleccionada = document.querySelector('input[name="costoDiseno_botones"]:checked');
        if(opcionDisenoSeleccionada) opcionDisenoSeleccionada.checked = false;

        precioUnitarioVentaEl.textContent = formatoMoneda(0);
        subtotalEl.textContent = formatoMoneda(0);
        costoDisenoTotalEl.textContent = formatoMoneda(0);
        ivaEl.textContent = formatoMoneda(0);
        totalEl.textContent = formatoMoneda(0);
        costoUnitarioNetoEl.textContent = formatoMoneda(0);
        costoUnitarioSinIvaEl.textContent = formatoMoneda(0);
        cantidadHojasEl.textContent = '0';
        utilidadAplicadaEl.textContent = 'N/A';
        detalleCostoBaseEl.textContent = '';
        costoBaseTotalEl.textContent = formatoMoneda(0);
        detalleCostoImpresionEl.textContent = '';
        costoImpresionTotalEl.textContent = formatoMoneda(0);
        detalleCostoCorteEl.textContent = '';
        costoCorteTotalEl.textContent = formatoMoneda(0);
        costoProduccionTotalEl.textContent = formatoMoneda(0);
        utilidadBrutaEl.textContent = formatoMoneda(0);
        resumenClienteEl.value = '';
    }

    function copiarResumen() {
        if (!resumenClienteEl.value) return;
        navigator.clipboard.writeText(resumenClienteEl.value).then(() => {
            const originalText = copiarBtn.textContent;
            copiarBtn.textContent = '¡Copiado!';
            copiarBtn.classList.add('btn-success');
            setTimeout(() => {
                copiarBtn.textContent = originalText;
                copiarBtn.classList.remove('btn-success');
            }, 2000);
        }).catch(err => console.error('Error al copiar: ', err));
    }

    cantidadInput.addEventListener('input', cotizar);
    opcionesDisenoEl.addEventListener('change', cotizar);
    limpiarBtn.addEventListener('click', limpiarCampos);
    copiarBtn.addEventListener('click', copiarResumen);
}

// ====================================================================

// =========== LÓGICA DEL COTIZADOR DE BRAZALETES =====================

// ====================================================================

{

    const cantidadInput = document.getElementById('cantidad_brazaletes');
    const tipoBrazaleteEl = document.getElementById('tipo_brazalete');
    const tipoImpresionEl = document.getElementById('tipo_impresion');
    const opcionesDisenoEl = document.getElementById('opcionesDiseno_brazaletes');
    const stockBrazaleteEl = document.getElementById('stock_brazalete');
    const subtotalEl = document.getElementById('subtotal_brazaletes');
    const costoDisenoTotalEl = document.getElementById('costoDisenoTotal_brazaletes');
    const costoPaqueteriaEl = document.getElementById('costoPaqueteria_brazaletes');
    const ivaEl = document.getElementById('iva_brazaletes');
    const totalEl = document.getElementById('total_brazaletes');
    const costoUnitarioSinIvaEl = document.getElementById('costoUnitarioSinIva_brazaletes');
    const costoUnitarioNetoEl = document.getElementById('costoUnitarioNeto_brazaletes');
    const precioUnitarioVentaEl = document.getElementById('precioUnitarioVenta_brazaletes');
    const utilidadAplicadaEl = document.getElementById('utilidadAplicada_brazaletes');
    const costoBaseTotalEl = document.getElementById('costoBaseTotal_brazaletes');
    const detalleCostoBaseEl = document.getElementById('detalleCostoBase_brazaletes');
    const costoMarcoEl = document.getElementById('costoMarco_brazaletes');
    const costoImpresionTotalEl = document.getElementById('costoImpresionTotal_brazaletes');
    const costoProduccionTotalEl = document.getElementById('costoProduccionTotal_brazaletes');
    const utilidadBrutaEl = document.getElementById('utilidadBruta_brazaletes');
    const resumenClienteEl = document.getElementById('resumenCliente_brazaletes');
    const limpiarBtn = document.getElementById('limpiar_brazaletes');
    const copiarBtn = document.getElementById('copiar_brazaletes');

    // Nuevos elementos para el desglose de descuento
    const infoDescuentoEl = document.getElementById('infoDescuentoSinImpresion');
    const precioOriginalEl = document.getElementById('precioOriginalSinImpresion');
    const porcentajeDescuentoEl = document.getElementById('porcentajeDescuento');
    const montoDescuentoEl = document.getElementById('montoDescuento');
    const precioFinalConDescuentoEl = document.getElementById('precioFinalConDescuento');
    const explicacionSubtotalEl = document.getElementById('explicacionSubtotalBrazaletes');

    const IVA_PERCENT = 0.16;
    const COSTO_MARCO_BASE = 130;
    const COSTO_PAQUETERIA = 300;

    const costosBase = { papel: 1.4, plastico: 3.5 };
    const preciosVenta = {
        papel: [
            { min: 1, max: 100, precio: 9.8, utilidad: 'x7' },
            { min: 101, max: 200, precio: 8.4, utilidad: 'x6' },
            { min: 201, max: 300, precio: 7, utilidad: 'x5' },
            { min: 301, max: 500, precio: 5.6, utilidad: 'x4' },
            { min: 501, max: Infinity, precio: 4.9, utilidad: 'x3.5' },
        ],
        plastico: [
            { min: 1, max: 100, precio: 21, utilidad: 'x5' },
            { min: 101, max: 200, precio: 14, utilidad: 'x4' },
            { min: 201, max: 300, precio: 12.25, utilidad: 'x3.5' },
            { min: 301, max: 500, precio: 10.5, utilidad: 'x3' },
            { min: 501, max: Infinity, precio: 8.75, utilidad: 'x2.5' },
        ]
    };

    function getPrecioVenta(cantidad, tipo) {
        const tabla = preciosVenta[tipo];
        const tier = tabla.find(t => cantidad >= t.min && cantidad <= t.max);
        return tier || { precio: 0, utilidad: 'N/A' };
    }

    function cotizar() {
        infoDescuentoEl.style.display = 'none'; // Ocultar por defecto
        explicacionSubtotalEl.textContent = "Se multiplica la cantidad de brazaletes por el 'Precio de Venta Unitario' que corresponde según la tabla de precios de arriba.";

        const cantidad = parseInt(cantidadInput.value, 10) || 0;
        if (cantidad <= 0) {
            limpiarCampos();
            return;
        }

        const tipo = document.querySelector('input[name="tipoBrazalete"]:checked').value;
        const tipoImpresion = document.querySelector('input[name="tipoImpresion"]:checked').value;
        const opcionDiseno = document.querySelector('input[name="costoDiseno_brazaletes"]:checked');
        const enStock = document.querySelector('input[name="stockBrazalete"]:checked').value === 'si';

        const costoDiseno = opcionDiseno ? parseFloat(opcionDiseno.value) : 0;
        const etiquetaDiseno = opcionDiseno ? opcionDiseno.dataset.label : "";
        const costoPaqueteria = enStock ? 0 : COSTO_PAQUETERIA;

        const { precio: precioVentaUnitario, utilidad } = getPrecioVenta(cantidad, tipo);
        let precioVentaFinal = precioVentaUnitario;
        let porcentajeDescuento = 0;

        if (tipoImpresion === 'sin_impresion') {
            if (cantidad >= 1 && cantidad <= 200) {
                porcentajeDescuento = 30;
                precioVentaFinal *= 0.70; // 30% discount
            } else if (cantidad >= 201 && cantidad <= 500) {
                porcentajeDescuento = 20;
                precioVentaFinal *= 0.80; // 20% discount
            }

            if(porcentajeDescuento > 0) {
                const montoDescuento = precioVentaUnitario - precioVentaFinal;
                infoDescuentoEl.style.display = 'block';
                precioOriginalEl.textContent = formatoMoneda(precioVentaUnitario);
                porcentajeDescuentoEl.textContent = `${porcentajeDescuento}%`;
                montoDescuentoEl.textContent = formatoMoneda(montoDescuento * -1);
                precioFinalConDescuentoEl.textContent = formatoMoneda(precioVentaFinal);
                explicacionSubtotalEl.textContent = "Se multiplica la cantidad por el 'Precio Unitario con Descuento' que se detalla arriba.";
            }
        }

        const subtotalBrazaletes = cantidad * precioVentaFinal;
        const subtotalGeneral = subtotalBrazaletes + costoDiseno + costoPaqueteria;
        const iva = subtotalGeneral * IVA_PERCENT;
        const total = subtotalGeneral + iva;
        const costoUnitarioNeto = total / cantidad;

        const costoBaseUnitario = costosBase[tipo];
        const costoBaseTotal = (cantidad + 10) * costoBaseUnitario; // +10 de sobrante
        const costoMarco = tipoImpresion === 'con_impresion' ? COSTO_MARCO_BASE : 0;
        const costoImpresion = tipoImpresion === 'con_impresion' ? Math.max(280, Math.ceil(cantidad / 10) * 20) : 0;
        const costoProduccionTotal = costoBaseTotal + costoMarco + costoImpresion;
        const utilidadBruta = subtotalBrazaletes - costoProduccionTotal;

        subtotalEl.textContent = formatoMoneda(subtotalBrazaletes);
        costoDisenoTotalEl.textContent = formatoMoneda(costoDiseno);
        costoPaqueteriaEl.textContent = formatoMoneda(costoPaqueteria);
        ivaEl.textContent = formatoMoneda(iva);
        totalEl.textContent = formatoMoneda(total);
        costoUnitarioSinIvaEl.textContent = formatoMoneda(precioVentaFinal);
        costoUnitarioNetoEl.textContent = formatoMoneda(costoUnitarioNeto);
        precioUnitarioVentaEl.textContent = formatoMoneda(precioVentaFinal);

        utilidadAplicadaEl.textContent = utilidad;
        detalleCostoBaseEl.textContent = `(${cantidad} + 10 pz) x ${formatoMoneda(costoBaseUnitario)} = `;
        costoBaseTotalEl.textContent = formatoMoneda(costoBaseTotal);
        costoMarcoEl.textContent = formatoMoneda(costoMarco);
        costoImpresionTotalEl.textContent = formatoMoneda(costoImpresion);
        costoProduccionTotalEl.textContent = formatoMoneda(costoProduccionTotal);
        utilidadBrutaEl.textContent = formatoMoneda(utilidadBruta);

        generarResumenCliente(cantidad, tipo, costoUnitarioNeto, total, costoDiseno, etiquetaDiseno, costoPaqueteria, tipoImpresion);
    }

    function generarResumenCliente(cantidad, tipo, costoUnitarioFinal, total, costoDiseno, etiquetaDiseno, costoPaqueteria, tipoImpresion) {
        const conSinImpresion = tipoImpresion === 'con_impresion' ? 'impreso a 1 tinta en serigrafía' : 'sin impresión';
        const nombreProducto = `Brazalete de ${tipo} ${conSinImpresion}`;
        let resumen = `Hola, te comparto la cotización: ${cantidad} pz de ${nombreProducto}, precio unitario: ${formatoMoneda(costoUnitarioFinal)}, total a pagar: ${formatoMoneda(total)} (IVA incluido).`;
        if (costoDiseno > 0) {
            resumen += ` ${etiquetaDiseno}.`;
        }
        if (costoPaqueteria > 0) {
            resumen += ` Incluye costo de paquetería.`;
        }
        resumenClienteEl.value = resumen;
    }

    function limpiarCampos() {
        cantidadInput.value = '';
        document.querySelector('input[name="costoDiseno_brazaletes"]:checked')?.removeAttribute('checked');
        const radiosDiseno = document.getElementsByName('costoDiseno_brazaletes');
        for(const radio of radiosDiseno) radio.checked = false;

        document.querySelector('input[name="tipoImpresion"][value="con_impresion"]').checked = true;

        subtotalEl.textContent = formatoMoneda(0);
        costoDisenoTotalEl.textContent = formatoMoneda(0);
        costoPaqueteriaEl.textContent = formatoMoneda(0);
        ivaEl.textContent = formatoMoneda(0);
        totalEl.textContent = formatoMoneda(0);
        costoUnitarioSinIvaEl.textContent = formatoMoneda(0);
        costoUnitarioNetoEl.textContent = formatoMoneda(0);
        precioUnitarioVentaEl.textContent = formatoMoneda(0);
        utilidadAplicadaEl.textContent = 'N/A';
        detalleCostoBaseEl.textContent = '';
        costoBaseTotalEl.textContent = formatoMoneda(0);
        costoMarcoEl.textContent = formatoMoneda(0);
        costoImpresionTotalEl.textContent = formatoMoneda(0);
        costoProduccionTotalEl.textContent = formatoMoneda(0);
        utilidadBrutaEl.textContent = formatoMoneda(0);
        resumenClienteEl.value = '';

        infoDescuentoEl.style.display = 'none';
        precioOriginalEl.textContent = '';
        porcentajeDescuentoEl.textContent = '';
        montoDescuentoEl.textContent = '';
        precioFinalConDescuentoEl.textContent = '';
    }

    function copiarResumen() {
        if (!resumenClienteEl.value) return;
        navigator.clipboard.writeText(resumenClienteEl.value).then(() => {
            const originalText = copiarBtn.textContent;
            copiarBtn.textContent = '¡Copiado!';
            copiarBtn.classList.add('btn-success');
            setTimeout(() => {
                copiarBtn.textContent = originalText;
                copiarBtn.classList.remove('btn-success');
            }, 2000);
        }).catch(err => console.error('Error al copiar: ', err));
    }

    cantidadInput.addEventListener('input', cotizar);
    tipoBrazaleteEl.addEventListener('change', cotizar);
    tipoImpresionEl.addEventListener('change', cotizar);
    opcionesDisenoEl.addEventListener('change', cotizar);
    stockBrazaleteEl.addEventListener('change', cotizar);
    limpiarBtn.addEventListener('click', limpiarCampos);
    copiarBtn.addEventListener('click', copiarResumen);
}

    </script>
</body>
</html>
