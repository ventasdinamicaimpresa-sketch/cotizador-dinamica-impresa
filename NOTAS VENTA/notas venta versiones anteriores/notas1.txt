<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cotizador de Imprenta</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .input-group {
            margin-bottom: 1rem;
        }
        .input-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #374151;
        }
        .input-group select, .input-group input[type="number"] {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #D1D5DB;
            border-radius: 0.5rem;
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        }
        .section-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #111827;
            border-bottom: 2px solid #1F2937;
            padding-bottom: 0.5rem;
            margin-bottom: 1.5rem;
        }
        .result-card {
            background-color: #F9FAFB;
            border: 1px solid #E5E7EB;
            border-radius: 0.75rem;
            padding: 2rem;
            margin-top: 2rem;
        }
        .result-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #111827;
            text-align: center;
        }
        .result-price {
            font-size: 2.5rem;
            font-weight: 800;
            color: #16A34A;
            text-align: center;
            margin: 1rem 0;
        }
        .result-breakdown {
            margin-top: 1.5rem;
            border-top: 1px dashed #D1D5DB;
            padding-top: 1.5rem;
        }
        .result-breakdown p {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }
        .result-breakdown span {
            font-weight: 600;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800 p-4 sm:p-8">

    <div class="max-w-4xl mx-auto bg-white p-6 sm:p-8 rounded-xl shadow-lg">
        <div class="text-center mb-8">
            <h1 class="text-3xl font-bold text-gray-900">Cotizador de Notas de Remisión</h1>
            <p class="text-gray-500 mt-2">Completa los campos para obtener un precio estimado.</p>
        </div>

        <form id="cotizadorForm" class="grid grid-cols-1 md:grid-cols-2 gap-x-8">
            
            <!-- SECCIÓN 1: INFORMACIÓN BÁSICA -->
            <fieldset class="md:col-span-2 border-t pt-6">
                <legend class="section-title">1. Información Básica</legend>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div class="input-group">
                        <label for="cantidad">Cantidad de Notas</label>
                        <input type="number" id="cantidad" value="1000" min="1" required>
                    </div>
                    <div class="input-group">
                        <label for="tamano">Tamaño</label>
                        <select id="tamano">
                            <option value="carta">Carta</option>
                            <option value="media_carta" selected>1/2 Carta</option>
                            <option value="tercio_carta">1/3 Carta</option>
                            <option value="cuarto_carta">1/4 Carta</option>
                            <option value="oficio">Oficio</option>
                            <option value="media_oficio">1/2 Oficio</option>
                            <option value="tercio_oficio">1/3 Oficio</option>
                            <option value="cuarto_oficio">1/4 Oficio</option>
                        </select>
                    </div>
                </div>
            </fieldset>

            <!-- SECCIÓN 2: TIPO DE PAPEL -->
            <fieldset class="md:col-span-2 border-t pt-6">
                <legend class="section-title">2. Tipo de Papel</legend>
                <div class="input-group">
                    <label>¿Lleva copias (Papel Autocopia)?</label>
                    <div class="flex items-center space-x-4">
                        <input type="radio" id="conCopia" name="tipoPapel" value="autocopia" checked>
                        <label for="conCopia">Sí</label>
                        <input type="radio" id="sinCopia" name="tipoPapel" value="simple">
                        <label for="sinCopia">No</label>
                    </div>
                </div>
                
                <!-- Opciones para Papel Autocopia -->
                <div id="opcionesAutocopia" class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div class="input-group">
                        <label for="numCopias">Número de Copias (además del original)</label>
                        <input type="number" id="numCopias" value="1" min="1">
                    </div>
                    <div id="coloresCopiasContainer" class="sm:col-span-2 grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <!-- Los selectores de color se generarán aquí -->
                    </div>
                </div>

                <!-- Opciones para Papel Simple -->
                <div id="opcionesSimple" class="hidden grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div class="input-group">
                        <label for="papelSimple">Tipo de Papel</label>
                        <select id="papelSimple">
                            <option value="bond75">Bond 75gr</option>
                            <option value="bond90">Bond 90gr</option>
                            <option value="bristol180">Bristol 180gr</option>
                            <option value="seguridadHoops">Seguridad Hoops</option>
                            <option value="seguridadOaktree">Seguridad Oaktree</option>
                        </select>
                    </div>
                    <div id="colorOaktreeContainer" class="input-group hidden">
                        <label for="colorOaktree">Color Papel Oaktree</label>
                        <select id="colorOaktree">
                            <option value="amarillo_claro">Amarillo Claro</option>
                            <option value="oro">Oro</option>
                            <option value="verde_claro">Verde Claro</option>
                            <option value="verde_oscuro">Verde Oscuro</option>
                            <option value="azul_claro">Azul Claro</option>
                            <option value="azul_oscuro">Azul Oscuro</option>
                            <option value="rosa">Rosa</option>
                            <option value="gris">Gris</option>
                        </select>
                    </div>
                </div>
            </fieldset>

            <!-- SECCIÓN 3: ACABADOS Y DISEÑO -->
            <fieldset class="md:col-span-2 border-t pt-6">
                 <legend class="section-title">3. Acabados y Diseño</legend>
                 <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">
                    <div class="input-group">
                        <label for="folio">¿Lleva Folio?</label>
                        <select id="folio">
                            <option value="no">No</option>
                            <option value="si">Sí</option>
                        </select>
                    </div>
                    <div id="folioColorContainer" class="input-group hidden">
                        <label for="folioColor">Color del Folio</label>
                        <select id="folioColor">
                            <option value="negro">Negro</option>
                            <option value="rojo">Rojo</option>
                            <option value="otro">Otro Color</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label for="impresion">Tipo de Impresión</label>
                        <select id="impresion">
                            <option value="bw">Blanco y Negro</option>
                            <option value="color1">1 Color Específico</option>
                            <option value="color2">2 Colores Específicos</option>
                            <option value="cmyk">Selección de Color (CMYK)</option>
                        </select>
                    </div>
                     <div class="input-group">
                        <label for="diseno">Diseño</label>
                        <select id="diseno">
                            <option value="cliente">Cliente envía diseño</option>
                            <option value="guardado">Diseño guardado aquí</option>
                            <option value="nuevo">Realizar diseño</option>
                        </select>
                    </div>
                 </div>
            </fieldset>
            
            <div class="md:col-span-2 mt-6">
                <button type="submit" class="w-full bg-blue-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-blue-700 transition-colors duration-300 text-lg">
                    Calcular Cotización
                </button>
            </div>
        </form>

        <div id="resultado" class="hidden"></div>
    </div>

    <script>
        // --- BASE DE DATOS DE COSTOS ---
        const COSTOS_PAPEL = {
            carta: {
                autocopia_original: 0.43,
                autocopia_final: 0.48,
                autocopia_intermedio: 0.40,
                bond75: 1.95,
                bond90: 0.20,
                seguridadHoops: 0.52,
                seguridadOaktree: 0.75,
                bristol180: 1.21
            },
            oficio: {
                autocopia_original: 0.43,
                autocopia_final: 0.48,
                autocopia_intermedio: 0.40,
                bond75: 0.20,
                bond90: 0.25,
                seguridadHoops: 0.69,
                seguridadOaktree: 1.00,
                bristol180: 1.21
            }
        };

        // --- LÓGICA DE LA INTERFAZ ---
        document.addEventListener('DOMContentLoaded', () => {
            const form = document.getElementById('cotizadorForm');
            
            // Elementos del DOM
            const conCopiaRadio = document.getElementById('conCopia');
            const sinCopiaRadio = document.getElementById('sinCopia');
            const opcionesAutocopia = document.getElementById('opcionesAutocopia');
            const opcionesSimple = document.getElementById('opcionesSimple');
            const papelSimpleSelect = document.getElementById('papelSimple');
            const colorOaktreeContainer = document.getElementById('colorOaktreeContainer');
            const folioSelect = document.getElementById('folio');
            const folioColorContainer = document.getElementById('folioColorContainer');
            const numCopiasInput = document.getElementById('numCopias');
            const coloresCopiasContainer = document.getElementById('coloresCopiasContainer');

            // Función para actualizar visibilidad de opciones de papel
            function actualizarOpcionesPapel() {
                if (conCopiaRadio.checked) {
                    opcionesAutocopia.classList.remove('hidden');
                    opcionesSimple.classList.add('hidden');
                    actualizarColoresCopias();
                } else {
                    opcionesAutocopia.classList.add('hidden');
                    opcionesSimple.classList.remove('hidden');
                }
            }

            // Función para actualizar visibilidad de color Oaktree
            function actualizarColorOaktree() {
                if (papelSimpleSelect.value === 'seguridadOaktree') {
                    colorOaktreeContainer.classList.remove('hidden');
                } else {
                    colorOaktreeContainer.classList.add('hidden');
                }
            }
            
            // Función para actualizar visibilidad de color de folio
            function actualizarColorFolio() {
                if (folioSelect.value === 'si') {
                    folioColorContainer.classList.remove('hidden');
                } else {
                    folioColorContainer.classList.add('hidden');
                }
            }
            
            // Función para generar selectores de color para copias
            function actualizarColoresCopias() {
                coloresCopiasContainer.innerHTML = '';
                const copias = parseInt(numCopiasInput.value) || 0;
                if (copias <= 0) return;

                const colores = ['Verde', 'Azul', 'Rosa', 'Amarillo'];
                
                // Copias intermedias
                for (let i = 1; i < copias; i++) {
                    const id = `intermedio_color_${i}`;
                    let html = `<div class="input-group"><label for="${id}">Color Intermedio ${i}</label><select id="${id}">`;
                    colores.forEach(color => {
                        html += `<option value="${color.toLowerCase()}">${color}</option>`;
                    });
                    html += `</select></div>`;
                    coloresCopiasContainer.innerHTML += html;
                }

                // Copia final
                const idFinal = 'final_color';
                let htmlFinal = `<div class="input-group"><label for="${idFinal}">Color Copia Final</label><select id="${idFinal}">`;
                colores.forEach(color => {
                    htmlFinal += `<option value="${color.toLowerCase()}">${color}</option>`;
                });
                htmlFinal += `</select></div>`;
                coloresCopiasContainer.innerHTML += htmlFinal;
            }


            // Event Listeners
            form.addEventListener('submit', (e) => {
                e.preventDefault();
                calcularCotizacion();
            });
            
            conCopiaRadio.addEventListener('change', actualizarOpcionesPapel);
            sinCopiaRadio.addEventListener('change', actualizarOpcionesPapel);
            papelSimpleSelect.addEventListener('change', actualizarColorOaktree);
            folioSelect.addEventListener('change', actualizarColorFolio);
            numCopiasInput.addEventListener('input', actualizarColoresCopias);

            // Inicializar estado de la UI
            actualizarOpcionesPapel();
            actualizarColorOaktree();
            actualizarColorFolio();
        });

        // --- MOTOR DE CÁLCULO ---
        function calcularCotizacion() {
            // 1. Recopilar datos del formulario
            const cantidad = parseInt(document.getElementById('cantidad').value);
            const tamano = document.getElementById('tamano').value;
            const esAutocopia = document.getElementById('conCopia').checked;
            const numCopias = esAutocopia ? parseInt(document.getElementById('numCopias').value) : 0;
            const papelSimple = document.getElementById('papelSimple').value;
            const llevaFolio = document.getElementById('folio').value === 'si';
            const folioColor = document.getElementById('folioColor').value;
            const impresion = document.getElementById('impresion').value;
            const diseno = document.getElementById('diseno').value;

            // 2. Cálculos iniciales
            const basePapel = tamano.includes('oficio') ? 'oficio' : 'carta';
            const factorDivision = {
                carta: 1, media_carta: 2, tercio_carta: 3, cuarto_carta: 4,
                oficio: 1, media_oficio: 2, tercio_oficio: 3, cuarto_oficio: 4
            }[tamano];

            const hojasRequeridasCliente = Math.ceil(cantidad / factorDivision);
            const numPartes = esAutocopia ? 1 + numCopias : 1;
            const totalHojasImprimir = hojasRequeridasCliente * numPartes;
            
            let resultado;
            // 3. Decidir método de impresión
            if (hojasRequeridasCliente <= 250) {
                resultado = calcularDigital(cantidad, tamano, esAutocopia, numCopias, papelSimple, llevaFolio, folioColor, impresion, diseno, basePapel, factorDivision, hojasRequeridasCliente, numPartes);
            } else {
                resultado = calcularOffset(cantidad, tamano, esAutocopia, numCopias, papelSimple, llevaFolio, impresion, diseno, basePapel, factorDivision, hojasRequeridasCliente, numPartes);
            }
            
            // 4. Mostrar resultado
            mostrarResultado(resultado);
        }
        
        function formatCurrency(value) {
            return new Intl.NumberFormat('es-MX', { style: 'currency', currency: 'MXN' }).format(value);
        }

        function mostrarResultado(res) {
            const resultadoDiv = document.getElementById('resultado');
            resultadoDiv.classList.remove('hidden');
            
            let breakdownHtml = `
                <p>Método de Producción: <span>${res.metodo}</span></p>
                <p>Costo de Papel: <span>${formatCurrency(res.costos.papel)}</span></p>
                <p>Costo de Impresión: <span>${formatCurrency(res.costos.impresion)}</span></p>
                <p>Costos de Acabados: <span>${formatCurrency(res.costos.acabados)}</span></p>
                <p>Costos de Servicios: <span>${formatCurrency(res.costos.servicios)}</span></p>
                <hr class="my-2 border-gray-300">
                <p class="font-bold">Subtotal: <span>${formatCurrency(res.subtotal)}</span></p>
            `;

            if (res.metodo === 'Offset') {
                breakdownHtml += `<p class="font-bold">Subtotal + Utilidad (38%): <span>${formatCurrency(res.subtotalConUtilidad)}</span></p>`;
            }
            
            breakdownHtml += `<p class="font-bold">IVA (16%): <span>${formatCurrency(res.iva)}</span></p>`;

            resultadoDiv.innerHTML = `
                <div class="result-card">
                    <h2 class="result-title">Cotización Estimada</h2>
                    <p class="result-price">${formatCurrency(res.total)}</p>
                    <div class="result-breakdown">
                        <h3 class="text-lg font-semibold mb-2 text-center text-gray-700">Desglose de Costos</h3>
                        ${breakdownHtml}
                    </div>
                </div>
            `;
            resultadoDiv.scrollIntoView({ behavior: 'smooth' });
        }

        // --- LÓGICA DE COTIZACIÓN DIGITAL ---
        function calcularDigital(cantidad, tamano, esAutocopia, numCopias, papelSimple, llevaFolio, folioColor, impresion, diseno, basePapel, factorDivision, hojasRequeridas, numPartes) {
            const costos = { papel: 0, impresion: 0, acabados: 0, servicios: 0 };
            
            // Costo Papel
            let costoBasePapel = 0;
            if (esAutocopia) {
                costoBasePapel += hojasRequeridas * COSTOS_PAPEL[basePapel].autocopia_original;
                costoBasePapel += hojasRequeridas * COSTOS_PAPEL[basePapel].autocopia_final;
                if (numCopias > 1) {
                    costoBasePapel += hojasRequeridas * (numCopias - 1) * COSTOS_PAPEL[basePapel].autocopia_intermedio;
                }
            } else {
                costoBasePapel = hojasRequeridas * COSTOS_PAPEL[basePapel][papelSimple];
            }
            costos.papel = costoBasePapel * 2;

            // Costo Impresión
            let tarifaImpresion = 0;
            const esImpresionBN = impresion === 'bw';
            const folioCambiaColor = llevaFolio && (folioColor === 'rojo' || folioColor === 'otro');
            
            if (!esImpresionBN || folioCambiaColor) { // Es a color o folio fuerza color
                tarifaImpresion = basePapel === 'carta' ? 6.0 : 6.5;
            } else { // Es blanco y negro
                tarifaImpresion = basePapel === 'carta' ? 0.8 : 0.86;
            }
            costos.impresion = (hojasRequeridas * numPartes) * tarifaImpresion;

            // Costos Acabados
            if (factorDivision === 2) costos.acabados += 100;
            if (factorDivision === 3) costos.acabados += 120;
            if (factorDivision === 4) costos.acabados += 125;
            costos.acabados += 85; // Pegado
            if (esAutocopia) costos.acabados += 80; // Copaginado

            // Costos Servicios
            if (llevaFolio) costos.servicios += 150;
            costos.servicios += { cliente: 60, guardado: 150, nuevo: 215.52 }[diseno];

            const subtotal = costos.papel + costos.impresion + costos.acabados + costos.servicios;
            const iva = subtotal * 0.16;
            const total = subtotal + iva;

            return { metodo: 'Digital', costos, subtotal, iva, total };
        }

        // --- LÓGICA DE COTIZACIÓN OFFSET ---
        function calcularOffset(cantidad, tamano, esAutocopia, numCopias, papelSimple, llevaFolio, impresion, diseno, basePapel, factorDivision, hojasRequeridasCliente, numPartes) {
            const costos = { papel: 0, placas: 0, impresion: 0, acabados: 0, servicios: 0 };
            
            const hojasProduccion = hojasRequeridasCliente + 180;
            const totalHojasImprimir = hojasProduccion * numPartes;
            
            // Costo Papel
            let costoUnitarioJuego = 0;
            if (esAutocopia) {
                costoUnitarioJuego += COSTOS_PAPEL[basePapel].autocopia_original;
                costoUnitarioJuego += COSTOS_PAPEL[basePapel].autocopia_final;
                if (numCopias > 1) {
                    costoUnitarioJuego += (numCopias - 1) * COSTOS_PAPEL[basePapel].autocopia_intermedio;
                }
            } else {
                costoUnitarioJuego = COSTOS_PAPEL[basePapel][papelSimple];
            }
            costos.papel = hojasProduccion * costoUnitarioJuego;

            // Costo Placas y Tinta
            let numPlacas = 0;
            let costoTintaMillar = 0;
            switch(impresion) {
                case 'bw': numPlacas = 1; costoTintaMillar = 150; break;
                case 'color1': numPlacas = 1; costoTintaMillar = 250; break;
                case 'color2': numPlacas = 2; costoTintaMillar = 500; break;
                case 'cmyk': numPlacas = 4; costoTintaMillar = 600; break;
            }
            costos.placas = numPlacas * 180;
            const millaresImpresion = Math.ceil(totalHojasImprimir / 1000);
            costos.impresion = millaresImpresion * costoTintaMillar;

            // Costos Acabados
            const bloquesCorte = Math.ceil(hojasProduccion / 500);
            let costoCorte = 0;
            if (factorDivision === 2) costoCorte = 100;
            if (factorDivision === 3) costoCorte = 120;
            if (factorDivision === 4) costoCorte = 125;
            costos.acabados += bloquesCorte * costoCorte;

            if (esAutocopia) {
                const millaresCopaginado = Math.ceil(totalHojasImprimir / 1000);
                costos.acabados += millaresCopaginado * 120;
            }
            if (llevaFolio) {
                const millaresFolio = Math.ceil(cantidad / 1000);
                costos.acabados += millaresFolio * 200;
            }
            const millaresPegado = Math.ceil(totalHojasImprimir / 1000);
            costos.acabados += millaresPegado * 85;

            // Costos Servicios (Diseño)
            costos.servicios = { cliente: 80, guardado: 150, nuevo: 215.52 }[diseno];

            const subtotal = costos.papel + costos.placas + costos.impresion + costos.acabados + costos.servicios;
            const subtotalConUtilidad = subtotal * 1.38;
            const iva = subtotalConUtilidad * 0.16;
            const total = subtotalConUtilidad + iva;
            
            // Reagrupamos para el desglose
            const costosAgrupados = {
                papel: costos.papel,
                impresion: costos.placas + costos.impresion,
                acabados: costos.acabados,
                servicios: costos.servicios
            };

            return { metodo: 'Offset', costos: costosAgrupados, subtotal, subtotalConUtilidad, iva, total };
        }

    </script>
</body>
</html>
