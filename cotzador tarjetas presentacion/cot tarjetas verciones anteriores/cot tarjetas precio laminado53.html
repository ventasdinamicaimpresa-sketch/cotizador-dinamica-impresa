<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cotizador de Tarjetas de Presentación V3</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" xintegrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/inter-font@3.19.1/index.min.css" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        'primary': '#1A73E8',
                        'secondary': '#E8F0FE',
                        'dark-bg': '#121212',
                        'dark-card': '#1E1E1E',
                        'dark-text': '#E0E0E0',
                        'dark-input': '#333333',
                        'custom-blue': '#007bff', /* Nuevo color azul */
                        'custom-red': '#dc3545', /* Nuevo color rojo */
                    },
                }
            }
        }
    </script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            transition: background-color 0.3s, color 0.3s;
        }

        .dark {
            background-color: #121212;
            color: #E0E0E0;
        }

        .dark .card {
            background-color: #1E1E1E;
            color: #E0E0E0;
        }

        .dark .form-input, .dark .form-select {
            background-color: #333333;
            color: #E0E0E0;
            border-color: #555555;
        }
        
        /* New style for inputs when they have a value */
        .form-input.input-filled, .form-select.input-filled {
            border-color: #007bff; /* custom-blue */
        }
        .dark .form-input.input-filled, .dark .form-select.input-filled {
            border-color: #007bff; /* custom-blue */
        }

        .dark .tab-button, .dark .selection-button {
            color: #E0E0E0;
            background-color: #333333;
        }

        /* Enhanced active state for selection buttons */
        .selection-button.active {
            background-color: #007bff; /* Use custom-blue for active state */
            color: white;
            border-color: #007bff; /* Use custom-blue for active state */
            box-shadow: 0 6px 10px -2px rgba(0, 0, 0, 0.2), 0 3px 6px -1px rgba(0, 0, 0, 0.1); /* Stronger shadow */
            transform: translateY(-2px); /* Slight lift effect */
        }
        .dark .selection-button.active {
            background-color: #007bff; /* Use custom-blue for active state */
            border-color: #007bff; /* Use custom-blue for active state */
        }

        .selection-button {
            transition: all 0.2s ease-in-out;
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            border: 1px solid transparent;
        }
        
        .selection-button:hover:not(.active) {
            background-color: #e5e7eb;
            border-color: #d1d5db;
        }
        .dark .selection-button:hover:not(.active) {
            background-color: #2a2a2a;
            border-color: #4a4a4a;
        }

        .dark .summary-box {
            background-color: #1E1E1E;
            border-color: #555555;
        }

        .sub-options-container {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out, opacity 0.3s ease-out;
            opacity: 0;
        }
        .sub-options-container.active {
            max-height: 200px; /* Ajustar según la altura del contenido */
            transition: max-height 0.3s ease-in, opacity 0.3s ease-in;
            opacity: 1;
        }

        /* Estilos para las pestañas de configuración */
        .config-tab-button {
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            font-weight: 500;
            transition: all 0.2s ease-in-out;
            background-color: #e0e0e0; /* Light gray for inactive tabs */
            color: #4a4a4a;
        }
        .dark .config-tab-button {
            background-color: #4a4a4a; /* Darker gray for inactive tabs in dark mode */
            color: #e0e0e0;
        }
        .config-tab-button.active {
            background-color: #1A73E8;
            color: white;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        .config-tab-button:hover:not(.active) {
            background-color: #d1d5db;
        }
        .dark .config-tab-button:hover:not(.active) {
            background-color: #5a5a5a;
        }

        .config-content {
            display: none;
            padding: 1rem;
            background-color: #f3f4f6; /* Light gray background for content */
            border-radius: 0.75rem;
            margin-top: 1rem;
            box-shadow: inset 0 1px 3px 0 rgba(0, 0, 0, 0.1);
        }
        .dark .config-content {
            background-color: #2a2a2a;
        }
        .config-content.active {
            display: block;
        }
    </style>
</head>
<body class="bg-gray-100 dark:bg-dark-bg p-4 flex items-center justify-center min-h-screen">

    <!-- Contenedor principal de la aplicación -->
    <div class="w-full max-w-7xl lg:flex lg:space-x-8">

        <!-- Formulario de cotización (izquierda) -->
        <div class="w-full lg:w-2/3 p-6 bg-white dark:bg-dark-card rounded-xl shadow-2xl space-y-8 md:p-10 mb-8 lg:mb-0">
            <!-- Encabezado y botón para alternar modo oscuro -->
            <div class="mb-6">
                <div class="flex justify-between items-center">
                    <h1 class="text-3xl sm:text-4xl font-bold text-gray-900 dark:text-dark-text">Cotizador de Tarjetas de Presentación <span class="text-lg font-normal">(Medida 9 x 5.5 cm)</span></h1>
                    <button id="theme-toggle" class="p-2 rounded-full bg-gray-200 dark:bg-dark-input text-gray-800 dark:text-gray-200 transition-colors duration-300">
                        <i class="fas fa-moon dark:hidden"></i>
                        <i class="fas fa-sun hidden dark:inline"></i>
                    </button>
                </div>
                <p class="text-sm text-gray-600 dark:text-gray-400 mt-2">Creado por: Joel Adrián Mtz Meza. <span style="color: red;">834</span><span style="color: blue;">1446103</span> whatts</p>
            </div>

            <form id="quote-form" class="space-y-6">
                <!-- Cantidad -->
                <div>
                    <label for="quantity" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Cantidad</label>
                    <input type="number" id="quantity" name="quantity" class="form-input w-full p-3 rounded-lg border-gray-300 dark:border-gray-600 focus:ring-primary focus:border-primary dark:bg-dark-input dark:text-dark-text transition-colors duration-300" min="1" placeholder="Ej. 1000">
                </div>

                <!-- Tipo de Papel (Menú desplegable) -->
                <div>
                    <label for="paper-select" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Tipo de Papel</label>
                    <select id="paper-select" name="paper-select" class="form-select w-full p-3 rounded-lg border-gray-300 dark:border-gray-600 focus:ring-primary focus:border-primary dark:bg-dark-input dark:text-dark-text transition-colors duration-300">
                        <option value="" disabled selected>Selecciona un tipo de papel</option>
                        <option value="opaline-white-225">Cartulina Opalina Blanca 225g</option>
                        <option value="opaline-ivory-225">Cartulina Opalina Marfil 225g</option>
                        <option value="couche-300">Couche 300g</option>
                        <option value="couche-250">Couche 250g</option>
                        <option value="sulfated-12pt">Cartulina Sulfatada 12pt</option>
                        <option value="kromakote">Cartulina Kromakote</option>
                        <option value="stardream">Cartulina Stardream</option>
                    </select>
                </div>

                <!-- Lados de Impresión -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Lados de Impresión</label>
                    <div class="flex gap-4">
                        <button type="button" class="selection-button py-3 px-4 rounded-lg bg-gray-50 dark:bg-dark-input text-sm font-medium text-gray-700 dark:text-gray-300 active" data-type="printing-sides" data-value="1">1 Lado</button>
                        <button type="button" class="selection-button py-3 px-4 rounded-lg bg-gray-50 dark:bg-dark-input text-sm font-medium text-gray-700 dark:text-gray-300" data-type="printing-sides" data-value="2">2 Lados</button>
                    </div>
                </div>
                
                <!-- Opciones de impresión (Frente y Reverso) -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Frente -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Impresión (Frente)</label>
                        <div class="flex gap-4">
                            <button type="button" class="selection-button py-3 px-4 rounded-lg bg-gray-50 dark:bg-dark-input text-sm font-medium text-gray-700 dark:text-gray-300 active" data-type="printing-front" data-value="color">Color</button>
                            <button type="button" class="selection-button py-3 px-4 rounded-lg bg-gray-50 dark:bg-dark-input text-sm font-medium text-gray-700 dark:text-gray-300" data-type="printing-front" data-value="bw">Blanco y Negro</button>
                        </div>
                    </div>
                    <!-- Reverso (se muestra solo si se elige 2 lados) -->
                    <div id="back-printing-options" class="hidden">
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Impresión (Reverso)</label>
                        <div class="flex gap-4">
                            <button type="button" class="selection-button py-3 px-4 rounded-lg bg-gray-50 dark:bg-dark-input text-sm font-medium text-gray-700 dark:text-gray-300" data-type="printing-back" data-value="color">Color</button>
                            <button type="button" class="selection-button py-3 px-4 rounded-lg bg-gray-50 dark:bg-dark-input text-sm font-medium text-gray-700 dark:text-gray-300" data-type="printing-back" data-value="bw">Blanco y Negro</button>
                        </div>
                    </div>
                </div>

                <!-- Acabados -->
                <div class="space-y-6">
                    <label class="block text-lg font-bold text-gray-900 dark:text-dark-text mb-2">Acabados</label>
                    
                    <!-- Opción Sin Acabados -->
                    <div class="p-4 rounded-lg bg-gray-100 dark:bg-dark-input">
                        <button type="button" class="selection-button w-full py-3 px-4 rounded-lg bg-gray-50 dark:bg-dark-input text-sm font-medium text-gray-700 dark:text-gray-300 active" data-type="no-finish" data-value="no-finish">Sin Acabados</button>
                    </div>

                    <!-- Contenedor para Laminado y Redondeo - Ahora en una cuadrícula -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <!-- Sección de Laminado -->
                        <div id="laminate-options" class="p-4 rounded-lg bg-gray-100 dark:bg-dark-input space-y-4">
                            <h4 class="text-md font-semibold text-gray-700 dark:text-gray-300">Laminado</h4>
                            <div>
                                <label class="block text-sm font-medium text-gray-600 dark:text-gray-400 mb-1">Lados</label>
                                <div class="flex gap-4">
                                    <button type="button" class="selection-button py-2 px-3 rounded-lg bg-gray-50 dark:bg-dark-input text-xs font-medium text-gray-700 dark:text-gray-300" data-type="laminate-sides" data-value="1-side">1 Lado</button>
                                    <button type="button" class="selection-button py-2 px-3 rounded-lg bg-gray-50 dark:bg-dark-input text-xs font-medium text-gray-700 dark:text-gray-300" data-type="laminate-sides" data-value="2-sides">2 Lados</button>
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-600 dark:text-gray-400 mb-1">Tipo de Acabado</label>
                                <div class="flex gap-4">
                                    <button type="button" class="selection-button py-2 px-3 rounded-lg bg-gray-50 dark:bg-dark-input text-xs font-medium text-gray-700 dark:text-gray-300" data-type="laminate-type" data-value="matte">Mate</button>
                                    <button type="button" class="selection-button py-2 px-3 rounded-lg bg-gray-50 dark:bg-dark-input text-xs font-medium text-gray-700 dark:text-gray-300" data-type="laminate-type" data-value="glossy">Brillante</button>
                                </div>
                            </div>
                        </div>

                        <!-- Sección de Redondeo de esquinas -->
                        <div id="rounded-options" class="p-4 rounded-lg bg-gray-100 dark:bg-dark-input space-y-4">
                            <h4 class="text-md font-semibold text-gray-700 dark:text-gray-300">Redondeo de esquinas</h4>
                            <div class="flex gap-4">
                                <button type="button" class="selection-button py-2 px-3 rounded-lg bg-gray-50 dark:bg-dark-input text-xs font-medium text-gray-700 dark:text-gray-300" data-type="rounded-corners" data-value="rounded-1">1 Esquina</button>
                                <button type="button" class="selection-button py-2 px-3 rounded-lg bg-gray-50 dark:bg-dark-input text-xs font-medium text-gray-700 dark:text-gray-300" data-type="rounded-corners" data-value="rounded-2">2 Esquinas</button>
                                <button type="button" class="selection-button py-2 px-3 rounded-lg bg-gray-50 dark:bg-dark-input text-xs font-medium text-gray-700 dark:text-gray-300" data-type="rounded-corners" data-value="rounded-4">4 Esquinas</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Opciones de Diseño -->
                <div class="space-y-6">
                    <label class="block text-lg font-bold text-gray-900 dark:text-dark-text mb-2">Opciones de Diseño</label>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <button type="button" class="selection-button py-3 px-4 rounded-lg bg-gray-50 dark:bg-dark-input text-sm font-medium text-gray-700 dark:text-gray-300 active" data-type="design-option" data-value="client-sends">Cliente envía diseño</button>
                        <button type="button" class="selection-button py-3 px-4 rounded-lg bg-gray-50 dark:bg-dark-input text-sm font-medium text-gray-700 dark:text-gray-300" data-type="design-option" data-value="create-design">Realizar diseño</button>
                        <button type="button" class="selection-button py-3 px-4 rounded-lg bg-gray-50 dark:bg-dark-input text-sm font-medium text-gray-700 dark:text-gray-300" data-type="design-option" data-value="saved-design">Diseño guardado aquí</button>
                    </div>
                </div>

                <!-- Botones de acción -->
                <div class="flex flex-col sm:flex-row justify-center gap-4 mt-8">
                    <button type="button" id="reset-btn" class="w-full sm:w-auto px-6 py-3 rounded-lg font-bold bg-gray-200 dark:bg-dark-input hover:bg-gray-300 dark:hover:bg-gray-700 text-gray-800 dark:text-gray-200 transition-colors duration-300">
                        <i class="fas fa-sync-alt mr-2"></i> Limpiar Campos
                    </button>
                </div>

                <!-- Configuración de Precios -->
                <div class="mt-10 pt-6 border-t border-gray-300 dark:border-gray-600 space-y-6">
                    <h3 class="text-xl font-bold text-gray-900 dark:text-dark-text">Configuración de Precios</h3>
                    <div class="flex gap-4 justify-center">
                        <!-- Removido 'active' de aquí -->
                        <button type="button" class="config-tab-button" data-tab="costos-papel">Costos Papel</button>
                        <button type="button" class="config-tab-button" data-tab="impresion">Impresión</button>
                        <button type="button" class="config-tab-button" data-tab="laminado">Laminado</button>
                    </div>

                    <!-- Removido 'active' de aquí -->
                    <div id="costos-papel-content" class="config-content">
                        <h4 class="text-md font-semibold text-gray-800 dark:text-gray-200 mb-4">Costos de Papel por Pliego (Doble Carta)</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <!-- Input para Cartulina Opalina Blanca 225g -->
                            <div>
                                <label for="paper-opaline-white-225" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Cartulina Opalina Blanca 225g</label>
                                <input type="number" step="0.01" id="paper-opaline-white-225" data-category="paper" data-item="opaline-white-225" class="form-input w-full p-2 rounded-lg border-gray-300 dark:border-gray-600 focus:ring-primary focus:border-primary dark:bg-dark-input dark:text-dark-text">
                            </div>
                            <!-- Input para Cartulina Opalina Marfil 225g -->
                            <div>
                                <label for="paper-opaline-ivory-225" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Cartulina Opalina Marfil 225g</label>
                                <input type="number" step="0.01" id="paper-opaline-ivory-225" data-category="paper" data-item="opaline-ivory-225" class="form-input w-full p-2 rounded-lg border-gray-300 dark:border-gray-600 focus:ring-primary focus:border-primary dark:bg-dark-input dark:text-dark-text">
                            </div>
                            <!-- Input para Couche 300g -->
                            <div>
                                <label for="paper-couche-300" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Couche 300g</label>
                                <input type="number" step="0.01" id="paper-couche-300" data-category="paper" data-item="couche-300" class="form-input w-full p-2 rounded-lg border-gray-300 dark:border-gray-600 focus:ring-primary focus:border-primary dark:bg-dark-input dark:text-dark-text">
                            </div>
                            <!-- Input para Couche 250g -->
                            <div>
                                <label for="paper-couche-250" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Couche 250g</label>
                                <input type="number" step="0.01" id="paper-couche-250" data-category="paper" data-item="couche-250" class="form-input w-full p-2 rounded-lg border-gray-300 dark:border-gray-600 focus:ring-primary focus:border-primary dark:bg-dark-input dark:text-dark-text">
                            </div>
                            <!-- Input para Cartulina Sulfatada 12pt -->
                            <div>
                                <label for="paper-sulfated-12pt" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Cartulina Sulfatada 12pt</label>
                                <input type="number" step="0.01" id="paper-sulfated-12pt" data-category="paper" data-item="sulfated-12pt" class="form-input w-full p-2 rounded-lg border-gray-300 dark:border-gray-600 focus:ring-primary focus:border-primary dark:bg-dark-input dark:text-dark-text">
                            </div>
                            <!-- Input para Cartulina Kromakote -->
                            <div>
                                <label for="paper-kromakote" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Cartulina Kromakote</label>
                                <input type="number" step="0.01" id="paper-kromakote" data-category="paper" data-item="kromakote" class="form-input w-full p-2 rounded-lg border-gray-300 dark:border-gray-600 focus:ring-primary focus:border-primary dark:bg-dark-input dark:text-dark-text">
                            </div>
                            <!-- Input para Cartulina Stardream -->
                            <div>
                                <label for="paper-stardream" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Cartulina Stardream</label>
                                <input type="number" step="0.01" id="paper-stardream" data-category="paper" data-item="stardream" class="form-input w-full p-2 rounded-lg border-gray-300 dark:border-gray-600 focus:ring-primary focus:border-primary dark:bg-dark-input dark:text-dark-text">
                            </div>
                        </div>
                    </div>

                    <!-- Contenido de Impresión -->
                    <div id="impresion-content" class="config-content">
                        <h4 class="text-md font-semibold text-gray-800 dark:text-gray-200 mb-4">Costos de Impresión por Pliego</h4>
                        
                        <!-- Impresión a Color -->
                        <div class="mb-6 p-4 bg-gray-200 dark:bg-dark-input rounded-lg">
                            <h5 class="font-semibold text-gray-700 dark:text-gray-300 mb-3">Impresión a Color</h5>
                            <div class="grid grid-cols-3 gap-2 text-sm items-center">
                                <div class="font-medium text-gray-600 dark:text-gray-400">Rango (pliegos)</div>
                                <div class="font-medium text-gray-600 dark:text-gray-400 text-center">1 Lado</div>
                                <div class="font-medium text-gray-600 dark:text-gray-400 text-center">2 Lados</div>

                                <!-- Rango 1-50 -->
                                <label class="text-gray-700 dark:text-gray-300">1-50 pliegos</label>
                                <input type="number" step="0.01" data-category="printing" data-type="color" data-range-idx="0" data-sides="1-side" class="form-input p-2 text-sm rounded-lg dark:bg-dark-card dark:border-gray-500">
                                <input type="number" step="0.01" data-category="printing" data-type="color" data-range-idx="0" data-sides="2-sides" class="form-input p-2 text-sm rounded-lg dark:bg-dark-card dark:border-gray-500">
                                
                                <!-- Rango 51-100 -->
                                <label class="text-gray-700 dark:text-gray-300">51-100 pliegos</label>
                                <input type="number" step="0.01" data-category="printing" data-type="color" data-range-idx="1" data-sides="1-side" class="form-input p-2 text-sm rounded-lg dark:bg-dark-card dark:border-gray-500">
                                <input type="number" step="0.01" data-category="printing" data-type="color" data-range-idx="1" data-sides="2-sides" class="form-input p-2 text-sm rounded-lg dark:bg-dark-card dark:border-gray-500">

                                <!-- Rango 101-150 -->
                                <label class="text-gray-700 dark:text-gray-300">101-150 pliegos</label>
                                <input type="number" step="0.01" data-category="printing" data-type="color" data-range-idx="2" data-sides="1-side" class="form-input p-2 text-sm rounded-lg dark:bg-dark-card dark:border-gray-500">
                                <input type="number" step="0.01" data-category="printing" data-type="color" data-range-idx="2" data-sides="2-sides" class="form-input p-2 text-sm rounded-lg dark:bg-dark-card dark:border-gray-500">

                                <!-- Rango 151-200 -->
                                <label class="text-gray-700 dark:text-gray-300">151-200 pliegos</label>
                                <input type="number" step="0.01" data-category="printing" data-type="color" data-range-idx="3" data-sides="1-side" class="form-input p-2 text-sm rounded-lg dark:bg-dark-card dark:border-gray-500">
                                <input type="number" step="0.01" data-category="printing" data-type="color" data-range-idx="3" data-sides="2-sides" class="form-input p-2 text-sm rounded-lg dark:bg-dark-card dark:border-gray-500">

                                <!-- Rango 201-500 -->
                                <label class="text-gray-700 dark:text-gray-300">201-500 pliegos</label>
                                <input type="number" step="0.01" data-category="printing" data-type="color" data-range-idx="4" data-sides="1-side" class="form-input p-2 text-sm rounded-lg dark:bg-dark-card dark:border-gray-500">
                                <input type="number" step="0.01" data-category="printing" data-type="color" data-range-idx="4" data-sides="2-sides" class="form-input p-2 text-sm rounded-lg dark:bg-dark-card dark:border-gray-500">

                                <!-- Rango 501-1000 -->
                                <label class="text-gray-700 dark:text-gray-300">501-1000 pliegos</label>
                                <input type="number" step="0.01" data-category="printing" data-type="color" data-range-idx="5" data-sides="1-side" class="form-input p-2 text-sm rounded-lg dark:bg-dark-card dark:border-gray-500">
                                <input type="number" step="0.01" data-category="printing" data-type="color" data-range-idx="5" data-sides="2-sides" class="form-input p-2 text-sm rounded-lg dark:bg-dark-card dark:border-gray-500">
                            </div>
                        </div>

                        <!-- Impresión Blanco y Negro -->
                        <div class="p-4 bg-gray-200 dark:bg-dark-input rounded-lg">
                            <h5 class="font-semibold text-gray-700 dark:text-gray-300 mb-3">Impresión Blanco y Negro</h5>
                            <div class="grid grid-cols-3 gap-2 text-sm items-center">
                                <div class="font-medium text-gray-600 dark:text-gray-400">Rango (pliegos)</div>
                                <div class="font-medium text-gray-600 dark:text-gray-400 text-center">1 Lado</div>
                                <div class="font-medium text-gray-600 dark:text-gray-400 text-center">2 Lados</div>

                                <!-- Rango 1-50 -->
                                <label class="text-gray-700 dark:text-gray-300">1-50 pliegos</label>
                                <input type="number" step="0.01" data-category="printing" data-type="bw" data-range-idx="0" data-sides="1-side" class="form-input p-2 text-sm rounded-lg dark:bg-dark-card dark:border-gray-500">
                                <input type="number" step="0.01" data-category="printing" data-type="bw" data-range-idx="0" data-sides="2-sides" class="form-input p-2 text-sm rounded-lg dark:bg-dark-card dark:border-gray-500">
                                
                                <!-- Rango 51-100 -->
                                <label class="text-gray-700 dark:text-gray-300">51-100 pliegos</label>
                                <input type="number" step="0.01" data-category="printing" data-type="bw" data-range-idx="1" data-sides="1-side" class="form-input p-2 text-sm rounded-lg dark:bg-dark-card dark:border-gray-500">
                                <input type="number" step="0.01" data-category="printing" data-type="bw" data-range-idx="1" data-sides="2-sides" class="form-input p-2 text-sm rounded-lg dark:bg-dark-card dark:border-gray-500">

                                <!-- Rango 101-150 -->
                                <label class="text-gray-700 dark:text-gray-300">101-150 pliegos</label>
                                <input type="number" step="0.01" data-category="printing" data-type="bw" data-range-idx="2" data-sides="1-side" class="form-input p-2 text-sm rounded-lg dark:bg-dark-card dark:border-gray-500">
                                <input type="number" step="0.01" data-category="printing" data-type="bw" data-range-idx="2" data-sides="2-sides" class="form-input p-2 text-sm rounded-lg dark:bg-dark-card dark:border-gray-500">

                                <!-- Rango 151-200 -->
                                <label class="text-gray-700 dark:text-gray-300">151-200 pliegos</label>
                                <input type="number" step="0.01" data-category="printing" data-type="bw" data-range-idx="3" data-sides="1-side" class="form-input p-2 text-sm rounded-lg dark:bg-dark-card dark:border-gray-500">
                                <input type="number" step="0.01" data-category="printing" data-type="bw" data-range-idx="3" data-sides="2-sides" class="form-input p-2 text-sm rounded-lg dark:bg-dark-card dark:border-gray-500">

                                <!-- Rango 201-500 -->
                                <label class="text-gray-700 dark:text-gray-300">201-500 pliegos</label>
                                <input type="number" step="0.01" data-category="printing" data-type="bw" data-range-idx="4" data-sides="1-side" class="form-input p-2 text-sm rounded-lg dark:bg-dark-card dark:border-gray-500">
                                <input type="number" step="0.01" data-category="printing" data-type="bw" data-range-idx="4" data-sides="2-sides" class="form-input p-2 text-sm rounded-lg dark:bg-dark-card dark:border-gray-500">

                                <!-- Rango 501-1000 -->
                                <label class="text-gray-700 dark:text-gray-300">501-1000 pliegos</label>
                                <input type="number" step="0.01" data-category="printing" data-type="bw" data-range-idx="5" data-sides="1-side" class="form-input p-2 text-sm rounded-lg dark:bg-dark-card dark:border-gray-500">
                                <input type="number" step="0.01" data-category="printing" data-type="bw" data-range-idx="5" data-sides="2-sides" class="form-input p-2 text-sm rounded-lg dark:bg-dark-card dark:border-gray-500">
                            </div>
                        </div>
                    </div>

                    <!-- Contenido de Laminado -->
                    <div id="laminado-content" class="config-content">
                        <h4 class="text-md font-semibold text-gray-800 dark:text-gray-200 mb-4">Costos de Laminado por Pliego</h4>
                        
                        <!-- Laminado Mate -->
                        <div class="mb-6 p-4 bg-gray-200 dark:bg-dark-input rounded-lg">
                            <h5 class="font-semibold text-gray-700 dark:text-gray-300 mb-3">Laminado Mate</h5>
                            <div class="grid grid-cols-3 gap-2 text-sm items-center">
                                <div class="font-medium text-gray-600 dark:text-gray-400">Rango (pliegos)</div>
                                <div class="font-medium text-gray-600 dark:text-gray-400 text-center">1 Lado</div>
                                <div class="font-medium text-gray-600 dark:text-gray-400 text-center">2 Lados</div>

                                <!-- Rango 1-50 -->
                                <label class="text-gray-700 dark:text-gray-300">1-50 pliegos</label>
                                <input type="number" step="0.01" data-category="laminate" data-type="matte" data-range-idx="0" data-sides="1-side" class="form-input p-2 text-sm rounded-lg dark:bg-dark-card dark:border-gray-500">
                                <input type="number" step="0.01" data-category="laminate" data-type="matte" data-range-idx="0" data-sides="2-sides" class="form-input p-2 text-sm rounded-lg dark:bg-dark-card dark:border-gray-500">
                                
                                <!-- Rango 51-100 -->
                                <label class="text-gray-700 dark:text-gray-300">51-100 pliegos</label>
                                <input type="number" step="0.01" data-category="laminate" data-type="matte" data-range-idx="1" data-sides="1-side" class="form-input p-2 text-sm rounded-lg dark:bg-dark-card dark:border-gray-500">
                                <input type="number" step="0.01" data-category="laminate" data-type="matte" data-range-idx="1" data-sides="2-sides" class="form-input p-2 text-sm rounded-lg dark:bg-dark-card dark:border-gray-500">

                                <!-- Rango 101-150 -->
                                <label class="text-gray-700 dark:text-gray-300">101-150 pliegos</label>
                                <input type="number" step="0.01" data-category="laminate" data-type="matte" data-range-idx="2" data-sides="1-side" class="form-input p-2 text-sm rounded-lg dark:bg-dark-card dark:border-gray-500">
                                <input type="number" step="0.01" data-category="laminate" data-type="matte" data-range-idx="2" data-sides="2-sides" class="form-input p-2 text-sm rounded-lg dark:bg-dark-card dark:border-gray-500">

                                <!-- Rango 151-200 -->
                                <label class="text-gray-700 dark:text-gray-300">151-200 pliegos</label>
                                <input type="number" step="0.01" data-category="laminate" data-type="matte" data-range-idx="3" data-sides="1-side" class="form-input p-2 text-sm rounded-lg dark:bg-dark-card dark:border-gray-500">
                                <input type="number" step="0.01" data-category="laminate" data-type="matte" data-range-idx="3" data-sides="2-sides" class="form-input p-2 text-sm rounded-lg dark:bg-dark-card dark:border-gray-500">

                                <!-- Rango 201-500 -->
                                <label class="text-gray-700 dark:text-gray-300">201-500 pliegos</label>
                                <input type="number" step="0.01" data-category="laminate" data-type="matte" data-range-idx="4" data-sides="1-side" class="form-input p-2 text-sm rounded-lg dark:bg-dark-card dark:border-gray-500">
                                <input type="number" step="0.01" data-category="laminate" data-type="matte" data-range-idx="4" data-sides="2-sides" class="form-input p-2 text-sm rounded-lg dark:bg-dark-card dark:border-gray-500">

                                <!-- Rango 501-1000 -->
                                <label class="text-gray-700 dark:text-gray-300">501-1000 pliegos</label>
                                <input type="number" step="0.01" data-category="laminate" data-type="matte" data-range-idx="5" data-sides="1-side" class="form-input p-2 text-sm rounded-lg dark:bg-dark-card dark:border-gray-500">
                                <input type="number" step="0.01" data-category="laminate" data-type="matte" data-range-idx="5" data-sides="2-sides" class="form-input p-2 text-sm rounded-lg dark:bg-dark-card dark:border-gray-500">
                            </div>
                        </div>

                        <!-- Laminado Brillante -->
                        <div class="p-4 bg-gray-200 dark:bg-dark-input rounded-lg">
                            <h5 class="font-semibold text-gray-700 dark:text-gray-300 mb-3">Laminado Brillante</h5>
                            <div class="grid grid-cols-3 gap-2 text-sm items-center">
                                <div class="font-medium text-gray-600 dark:text-gray-400">Rango (pliegos)</div>
                                <div class="font-medium text-gray-600 dark:text-gray-400 text-center">1 Lado</div>
                                <div class="font-medium text-gray-600 dark:text-gray-400 text-center">2 Lados</div>

                                <!-- Rango 1-50 -->
                                <label class="text-gray-700 dark:text-gray-300">1-50 pliegos</label>
                                <input type="number" step="0.01" data-category="laminate" data-type="glossy" data-range-idx="0" data-sides="1-side" class="form-input p-2 text-sm rounded-lg dark:bg-dark-card dark:border-gray-500">
                                <input type="number" step="0.01" data-category="laminate" data-type="glossy" data-range-idx="0" data-sides="2-sides" class="form-input p-2 text-sm rounded-lg dark:bg-dark-card dark:border-gray-500">
                                
                                <!-- Rango 51-100 -->
                                <label class="text-gray-700 dark:text-gray-300">51-100 pliegos</label>
                                <input type="number" step="0.01" data-category="laminate" data-type="glossy" data-range-idx="1" data-sides="1-side" class="form-input p-2 text-sm rounded-lg dark:bg-dark-card dark:border-gray-500">
                                <input type="number" step="0.01" data-category="laminate" data-type="glossy" data-range-idx="1" data-sides="2-sides" class="form-input p-2 text-sm rounded-lg dark:bg-dark-card dark:border-gray-500">

                                <!-- Rango 101-150 -->
                                <label class="text-gray-700 dark:text-gray-300">101-150 pliegos</label>
                                <input type="number" step="0.01" data-category="laminate" data-type="glossy" data-range-idx="2" data-sides="1-side" class="form-input p-2 text-sm rounded-lg dark:bg-dark-card dark:border-gray-500">
                                <input type="number" step="0.01" data-category="laminate" data-type="glossy" data-range-idx="2" data-sides="2-sides" class="form-input p-2 text-sm rounded-lg dark:bg-dark-card dark:border-gray-500">

                                <!-- Rango 151-200 -->
                                <label class="text-gray-700 dark:text-gray-300">151-200 pliegos</label>
                                <input type="number" step="0.01" data-category="laminate" data-type="glossy" data-range-idx="3" data-sides="1-side" class="form-input p-2 text-sm rounded-lg dark:bg-dark-card dark:border-gray-500">
                                <input type="number" step="0.01" data-category="laminate" data-type="glossy" data-range-idx="3" data-sides="2-sides" class="form-input p-2 text-sm rounded-lg dark:bg-dark-card dark:border-gray-500">

                                <!-- Rango 201-500 -->
                                <label class="text-gray-700 dark:text-gray-300">201-500 pliegos</label>
                                <input type="number" step="0.01" data-category="laminate" data-type="glossy" data-range-idx="4" data-sides="1-side" class="form-input p-2 text-sm rounded-lg dark:bg-dark-card dark:border-gray-500">
                                <input type="number" step="0.01" data-category="laminate" data-type="glossy" data-range-idx="4" data-sides="2-sides" class="form-input p-2 text-sm rounded-lg dark:bg-dark-card dark:border-gray-500">

                                <!-- Rango 501-1000 -->
                                <label class="text-gray-700 dark:text-gray-300">501-1000 pliegos</label>
                                <input type="number" step="0.01" data-category="laminate" data-type="glossy" data-range-idx="5" data-sides="1-side" class="form-input p-2 text-sm rounded-lg dark:bg-dark-card dark:border-gray-500">
                                <input type="number" step="0.01" data-category="laminate" data-type="glossy" data-range-idx="5" data-sides="2-sides" class="form-input p-2 text-sm rounded-lg dark:bg-dark-card dark:border-gray-500">
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </div>

        <!-- Resumen de cotización (derecha) -->
        <div class="w-full lg:w-1/3 p-6 bg-secondary dark:bg-dark-card rounded-xl shadow-lg summary-box">
            <h2 class="text-xl font-bold text-gray-900 dark:text-dark-text mb-4">Resumen de Cotización</h2>
            <div id="summary-content" class="text-gray-700 dark:text-gray-300 space-y-4">
                <p><strong>Cantidad:</strong> <span id="summary-quantity">--</span></p>
                <p><strong>Papel:</strong> <span id="summary-paper">--</span></p>
                <p class="text-sm text-gray-500 dark:text-gray-400">Costo de papel: <span id="sheets-needed">0</span> pliegos x $<span id="cost-per-single-paper-sheet">0.00</span> = $<span id="total-paper-cost">0.00</span></p>
                <p><strong>Impresión:</strong> <span id="summary-printing">--</span></p>
                <p class="text-sm text-gray-500 dark:text-gray-400">Costo de impresión: <span id="sheets-needed-for-printing-display">0</span> pliegos x $<span id="cost-per-printing-sheet">0.00</span> = $<span id="total-printing-cost-batch">0.00</span></p>
                <p><strong>Acabados:</strong> <span id="summary-finishes">--</span></p>
                <p id="laminate-detail" class="text-sm text-gray-500 dark:text-gray-400 hidden"></p>
                <p id="rounded-detail" class="text-sm text-gray-500 dark:text-gray-400 hidden"></p>
                <p class="text-sm text-gray-500 dark:text-gray-400">Corte de tarjetas: $<span id="cutting-cost-display">220.00</span></p>
                <p><strong>Diseño:</strong> <span id="summary-design-option">--</span></p>
                <p id="design-cost-detail" class="text-sm text-gray-500 dark:text-gray-400 hidden"></p>
            </div>
            
            <div class="mt-8 pt-4 border-t border-gray-300 dark:border-gray-600">
                <!-- Reordenado: Unitario (sin IVA) primero -->
                <p class="text-lg font-semibold text-gray-900 dark:text-dark-text">Unitario (sin IVA): <span id="unit-price-no-iva" class="font-bold text-custom-blue dark:text-custom-blue">$0.00</span></p>
                <p class="text-lg font-semibold text-gray-900 dark:text-dark-text">Subtotal:</p>
                <p id="subtotal-cost" class="text-2xl font-bold text-gray-800 dark:text-gray-200">$0.00</p>
                <p class="text-lg font-semibold text-gray-900 dark:text-dark-text">IVA (16%):</p>
                <p id="iva-cost" class="text-2xl font-bold text-gray-800 dark:text-gray-200">$0.00</p>
                <p class="text-lg font-semibold text-gray-900 dark:text-dark-text">Total:</p>
                <p id="final-total-cost" class="text-4xl font-extrabold text-custom-red dark:text-custom-red">$0.00</p>
                <p id="error-message" class="text-red-500 text-sm mt-2 hidden">Por favor, completa todos los campos para calcular el costo.</p>
                <p id="simplified-description" class="text-sm text-gray-600 dark:text-gray-400 mt-4"></p>
            </div>
        </div>
    </div>

    <!-- Script de la aplicación -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Mapeo de precios por defecto (valores iniciales)
            const defaultPrices = {
                paper: {
                    'opaline-white-225': 1.84,
                    'opaline-ivory-225': 1.55,
                    'couche-300': 1.35,
                    'couche-250': 1.13,
                    'sulfated-12pt': 2.34,
                    'kromakote': 3.695,
                    'stardream': 13.85,
                },
                printing: {
                    color: [
                        { range: [1, 50], '1-side': 12.08, '2-sides': 24.16 },
                        { range: [51, 100], '1-side': 12, '2-sides': 24 },
                        { range: [101, 150], '1-side': 11.8, '2-sides': 23.6 },
                        { range: [151, 200], '1-side': 11.6, '2-sides': 23.2 },
                        { range: [201, 500], '1-side': 11.3, '2-sides': 22.6 },
                        { range: [501, 1000], '1-side': 10.5, '2-sides': 21 }
                    ],
                    bw: [
                        { range: [1, 50], '1-side': 2.4, '2-sides': 4.8 },
                        { range: [51, 100], '1-side': 2.2, '2-sides': 4.4 },
                        { range: [101, 150], '1-side': 2, '2-sides': 4 },
                        { range: [151, 200], '1-side': 1.7, '2-sides': 3.4 },
                        { range: [201, 500], '1-side': 1.6, '2-sides': 3.2 },
                        { range: [501, 1000], '1-side': 1.56, '2-sides': 3.12 }
                    ]
                },
                finishes: {
                    'no-finish': 0,
                    laminate: {
                        matte: [
                            { range: [1, 50], '1-side': 5.852, '2-sides': 11.704 },
                            { range: [51, 100], '1-side': 5.0875, '2-sides': 10.175 },
                            { range: [101, 150], '1-side': 3.63, '2-sides': 6.534 },
                            { range: [151, 200], '1-side': 3.234, '2-sides': 5.4978 },
                            { range: [201, 500], '1-side': 2.42, '2-sides': 3.63 },
                            { range: [501, 1000], '1-side': 2.42, '2-sides': 3.63 } 
                        ],
                        glossy: [
                            { range: [1, 50], '1-side': 5.32, '2-sides': 10.64 },
                            { range: [51, 100], '1-side': 4.625, '2-sides': 9.25 },
                            { range: [101, 150], '1-side': 3.3, '2-sides': 5.94 },
                            { range: [151, 200], '1-side': 2.94, '2-sides': 4.998 },
                            { range: [201, 500], '1-side': 2.2, '2-sides': 3.3 },
                            { range: [501, 1000], '1-side': 2.2, '2-sides': 3.3 } 
                        ]
                    },
                    'rounded-1': 35, 
                    'rounded-2': 45, 
                    'rounded-4': 60, 
                },
                design: {
                    'client-sends': 0,
                    'create-design': 250,
                    'saved-design': 150
                }
            };
            
            // Precios actuales, se cargarán desde localStorage o usarán los por defecto
            let currentPrices = JSON.parse(JSON.stringify(defaultPrices)); // Copia profunda de los precios por defecto

            // Estado global de la aplicación para gestionar las selecciones
            let appState = {
                quantity: 0,
                paper: null,
                printingSides: '1',
                printingFront: 'color',
                printingBack: null,
                noFinish: true,
                laminateSides: null,
                laminateType: null,
                roundedCorners: null,
                designOption: 'client-sends',
                sheetsNeeded: 0, 
                paperCostTotal: 0, 
                paperCostPerSheetValue: 0, 
                printingCostPerSheet: 0, 
                totalPrintingCostForBatch: 0, 
                totalLaminateCost: 0, 
                laminatePricePerSheetValue: 0, 
                cuttingCost: 220, 
                roundedCornersCost: 0, 
                designCost: 0, 
                subtotal: 0, 
                iva: 0,      
                finalTotal: 0,
                unitPriceNoIva: 0 // Nuevo estado para el precio unitario sin IVA
            };

            // Elementos del DOM
            const quantityInput = document.getElementById('quantity');
            const paperSelect = document.getElementById('paper-select');
            const noFinishButton = document.querySelector('[data-type="no-finish"]');
            const selectionButtons = document.querySelectorAll('.selection-button:not([data-type="no-finish"])');
            const backPrintingOptions = document.getElementById('back-printing-options');
            const subtotalCostEl = document.getElementById('subtotal-cost'); 
            const unitPriceNoIvaEl = document.getElementById('unit-price-no-iva'); // Nuevo elemento
            const ivaCostEl = document.getElementById('iva-cost'); 
            const finalTotalCostEl = document.getElementById('final-total-cost'); 
            const errorMessageEl = document.getElementById('error-message');
            const resetButton = document.getElementById('reset-btn');
            const themeToggleBtn = document.getElementById('theme-toggle');

            // Elementos para el desglose del cálculo en el resumen
            const sheetsNeededEl = document.getElementById('sheets-needed');
            const totalPaperCostEl = document.getElementById('total-paper-cost');
            const costPerSinglePaperSheetEl = document.getElementById('cost-per-single-paper-sheet'); 
            const sheetsNeededForPrintingDisplayEl = document.getElementById('sheets-needed-for-printing-display'); 
            const costPerPrintingSheetEl = document.getElementById('cost-per-printing-sheet');
            const totalPrintingCostBatchEl = document.getElementById('total-printing-cost-batch'); 
            const laminateDetailEl = document.getElementById('laminate-detail'); 
            const roundedDetailEl = document.getElementById('rounded-detail'); 
            const cuttingCostDisplayEl = document.getElementById('cutting-cost-display'); 
            const summaryDesignOptionEl = document.getElementById('summary-design-option'); 
            const designCostDetailEl = document.getElementById('design-cost-detail'); 
            const simplifiedDescriptionEl = document.getElementById('simplified-description'); 

            // Elementos para la configuración de precios
            const configTabButtons = document.querySelectorAll('.config-tab-button');
            const configContents = document.querySelectorAll('.config-content');
            const priceInputs = document.querySelectorAll('.config-content input[type="number"]');


            // --- Funciones de persistencia de precios ---

            // Cargar precios desde localStorage
            const loadPrices = () => {
                const savedPrices = localStorage.getItem('customPrices');
                if (savedPrices) {
                    try {
                        currentPrices = JSON.parse(savedPrices);
                    } catch (e) {
                        console.error("Error al parsear precios de localStorage:", e);
                        currentPrices = JSON.parse(JSON.stringify(defaultPrices)); // Usar por defecto si hay error
                    }
                } else {
                    currentPrices = JSON.parse(JSON.stringify(defaultPrices)); // Usar por defecto si no hay nada guardado
                }
            };

            // Guardar precios en localStorage
            const savePrices = () => {
                localStorage.setItem('customPrices', JSON.stringify(currentPrices));
            };

            // Rellenar los inputs de configuración con los precios actuales
            const populatePriceInputs = () => {
                // Papel
                for (const paperType in currentPrices.paper) {
                    const input = document.getElementById(`paper-${paperType}`);
                    if (input) {
                        input.value = currentPrices.paper[paperType].toFixed(3); // Mostrar con más decimales para precisión
                    }
                }

                // Impresión
                for (const colorType in currentPrices.printing) {
                    currentPrices.printing[colorType].forEach((range, idx) => {
                        const input1Side = document.querySelector(`[data-category="printing"][data-type="${colorType}"][data-range-idx="${idx}"][data-sides="1-side"]`);
                        const input2Sides = document.querySelector(`[data-category="printing"][data-type="${colorType}"][data-range-idx="${idx}"][data-sides="2-sides"]`);
                        if (input1Side) input1Side.value = range['1-side'].toFixed(2);
                        if (input2Sides) input2Sides.value = range['2-sides'].toFixed(2);
                    });
                }

                // Laminado
                for (const laminateType in currentPrices.finishes.laminate) {
                    currentPrices.finishes.laminate[laminateType].forEach((range, idx) => {
                        const input1Side = document.querySelector(`[data-category="laminate"][data-type="${laminateType}"][data-range-idx="${idx}"][data-sides="1-side"]`);
                        const input2Sides = document.querySelector(`[data-category="laminate"][data-type="${laminateType}"][data-range-idx="${idx}"][data-sides="2-sides"]`);
                        
                        // Mensajes de depuración para Laminado
                        // console.log(`[DEBUG LAMINADO] Tipo de laminado: ${laminateType}, Índice: ${idx}`);
                        // console.log(`[DEBUG LAMINADO] Valor 1-lado (del objeto): ${range['1-side']}`);
                        // console.log(`[DEBUG LAMINADO] Valor 2-lados (del objeto): ${range['2-sides']}`);
                        // console.log(`[DEBUG LAMINADO] Elemento 1-lado encontrado: ${!!input1Side}`);
                        // console.log(`[DEBUG LAMINADO] Elemento 2-lados encontrado: ${!!input2Sides}`);

                        if (input1Side) input1Side.value = range['1-side'].toFixed(3);
                        if (input2Sides) input2Sides.value = range['2-sides'].toFixed(3);
                    });
                }
            };


            // --- Funciones de control de UI y lógica de cálculo ---

            // Función para actualizar el resumen de selecciones en la UI
            const updateSummary = () => {
                document.getElementById('summary-quantity').textContent = appState.quantity || '--';
                
                const selectedPaperOption = paperSelect.options[paperSelect.selectedIndex];
                document.getElementById('summary-paper').textContent = selectedPaperOption.value ? selectedPaperOption.text : '--';
                
                let printingText = 'No seleccionado';
                if (appState.printingFront) {
                    const frontLabel = document.querySelector(`[data-type="printing-front"][data-value="${appState.printingFront}"]`).textContent.trim();
                    printingText = `Frente: ${frontLabel}`;
                    if (appState.printingSides === '2' && appState.printingBack) {
                        const backLabel = document.querySelector(`[data-type="printing-back"][data-value="${appState.printingBack}"]`).textContent.trim();
                        printingText += `, Reverso: ${backLabel}`;
                    }
                }
                document.getElementById('summary-printing').textContent = printingText;
                
                let finishesText = 'Sin acabados';
                if (!appState.noFinish) {
                    let finishesParts = [];
                    if (appState.laminateSides && appState.laminateType) {
                        const sidesLabel = document.querySelector(`[data-type="laminate-sides"][data-value="${appState.laminateSides}"]`).textContent.trim();
                        const typeLabel = document.querySelector(`[data-type="laminate-type"][data-value="${appState.laminateType}"]`).textContent.trim();
                        finishesParts.push(`Laminado: ${sidesLabel}, ${typeLabel}`);
                        laminateDetailEl.textContent = `Laminado: ${appState.sheetsNeeded} pliegos x $${appState.laminatePricePerSheetValue.toFixed(2)} = $${appState.totalLaminateCost.toFixed(2)}`;
                        laminateDetailEl.classList.remove('hidden');
                    } else {
                        laminateDetailEl.classList.add('hidden');
                    }
                    if (appState.roundedCorners) {
                        const roundedLabel = document.querySelector(`[data-type="rounded-corners"][data-value="${appState.roundedCorners}"]`).textContent.trim();
                        finishesParts.push(`Redondeo: ${roundedLabel}`);
                        roundedDetailEl.textContent = `Redondeo: $${appState.roundedCornersCost.toFixed(2)}`;
                        roundedDetailEl.classList.remove('hidden');
                    } else {
                        roundedDetailEl.classList.add('hidden');
                    }
                    finishesText = finishesParts.join(', ');
                } else {
                    laminateDetailEl.classList.add('hidden');
                    roundedDetailEl.classList.add('hidden');
                }
                document.getElementById('summary-finishes').textContent = finishesText;

                const designOptionLabel = document.querySelector(`[data-type="design-option"][data-value="${appState.designOption}"]`).textContent.trim();
                summaryDesignOptionEl.textContent = designOptionLabel;
                if (appState.designCost > 0) {
                    designCostDetailEl.textContent = `Costo de diseño: $${appState.designCost.toFixed(2)}`;
                    designCostDetailEl.classList.remove('hidden');
                } else {
                    designCostDetailEl.classList.add('hidden');
                }

                sheetsNeededEl.textContent = appState.sheetsNeeded;
                costPerSinglePaperSheetEl.textContent = appState.paperCostPerSheetValue.toFixed(2);
                totalPaperCostEl.textContent = appState.paperCostTotal.toFixed(2);
                
                sheetsNeededForPrintingDisplayEl.textContent = appState.sheetsNeeded; 
                costPerPrintingSheetEl.textContent = appState.printingCostPerSheet.toFixed(2);
                totalPrintingCostBatchEl.textContent = appState.totalPrintingCostForBatch.toFixed(2);
                
                cuttingCostDisplayEl.textContent = appState.cuttingCost.toFixed(2); 

                subtotalCostEl.textContent = `$${appState.subtotal.toFixed(2)}`;
                unitPriceNoIvaEl.textContent = `$${appState.unitPriceNoIva.toFixed(2)}`; // Mostrar el precio unitario sin IVA
                ivaCostEl.textContent = `$${appState.iva.toFixed(2)}`;
                finalTotalCostEl.textContent = `$${appState.finalTotal.toFixed(2)}`;

                // Generar descripción simplificada
                let descriptionParts = [];
                if (appState.quantity > 0) {
                    descriptionParts.push(`${appState.quantity} tarjetas de presentación (9x5.5cm)`);
                }
                if (selectedPaperOption.value) {
                    descriptionParts.push(`en ${selectedPaperOption.text.toLowerCase()}`);
                }
                if (appState.printingFront) {
                    const frontColorLabel = document.querySelector(`[data-type="printing-front"][data-value="${appState.printingFront}"]`).textContent.trim().toLowerCase();
                    let printingDesc = `frente impreso a ${frontColorLabel}`;

                    if (appState.printingSides === '2' && appState.printingBack) {
                        const backColorLabel = document.querySelector(`[data-type="printing-back"][data-value="${appState.printingBack}"]`).textContent.trim().toLowerCase();
                        printingDesc += `, reverso impreso a ${backColorLabel}`;
                    }
                    descriptionParts.push(printingDesc);
                }

                let finishesDescParts = [];
                if (!appState.noFinish) {
                    if (appState.laminateSides && appState.laminateType) {
                        const sidesLabel = document.querySelector(`[data-type="laminate-sides"][data-value="${appState.laminateSides}"]`).textContent.trim().toLowerCase();
                        const typeLabel = document.querySelector(`[data-type="laminate-type"][data-value="${appState.laminateType}"]`).textContent.trim().toLowerCase();
                        finishesDescParts.push(`con laminado ${typeLabel} ${sidesLabel}`);
                    }
                    if (appState.roundedCorners) {
                        const roundedLabel = document.querySelector(`[data-type="rounded-corners"][data-value="${appState.roundedCorners}"]`).textContent.trim().toLowerCase();
                        finishesDescParts.push(`con ${roundedLabel}`);
                    }
                }
                if (finishesDescParts.length > 0) {
                    descriptionParts.push(finishesDescParts.join(' y '));
                } else {
                    descriptionParts.push('sin acabados');
                }
                
                descriptionParts.push(`, ${designOptionLabel.toLowerCase()}`);

                let finalDescription = descriptionParts.join(' ');

                // Agregar costo unitario y total (modificado para quitar paréntesis y añadir "neto")
                if (appState.quantity > 0 && appState.finalTotal > 0) {
                    finalDescription += ` $${appState.unitPriceNoIva.toFixed(2)} c/u, total = $${appState.finalTotal.toFixed(2)} neto`;
                }

                simplifiedDescriptionEl.textContent = finalDescription;
            };

            // Función para obtener el costo de impresión por la cantidad de pliegos
            const getPrintingCostForSheets = (colorType, sheetsQuantity, sidesConfig) => {
                const priceList = currentPrices.printing[colorType]; // Usar currentPrices
                const priceEntry = priceList.find(p => sheetsQuantity >= p.range[0] && sheetsQuantity <= p.range[1]);
                return priceEntry ? priceEntry[sidesConfig] : 0;
            };

            // Función para obtener el costo de laminado por la cantidad de pliegos
            const getLaminateCostForSheets = (laminateType, sheetsQuantity, sidesConfig) => {
                const priceList = currentPrices.finishes.laminate[laminateType]; // Usar currentPrices
                const priceEntry = priceList.find(p => sheetsQuantity >= p.range[0] && sheetsQuantity <= p.range[1]);
                return priceEntry ? priceEntry[sidesConfig] : 0;
            };

            // Función principal para calcular el costo total
            const calculateTotal = () => {
                const { quantity, paper, printingSides, printingFront, printingBack, noFinish, laminateSides, laminateType, roundedCorners, designOption } = appState;

                if (quantity <= 0 || !paper || !printingFront || (printingSides === '2' && !printingBack)) {
                    subtotalCostEl.textContent = '$0.00';
                    unitPriceNoIvaEl.textContent = '$0.00'; // Resetear el precio unitario sin IVA
                    ivaCostEl.textContent = '$0.00';
                    finalTotalCostEl.textContent = '$0.00';
                    errorMessageEl.classList.remove('hidden');
                    appState.sheetsNeeded = 0;
                    appState.paperCostTotal = 0;
                    appState.paperCostPerSheetValue = 0;
                    appState.printingCostPerSheet = 0;
                    appState.totalPrintingCostForBatch = 0;
                    appState.totalLaminateCost = 0; 
                    appState.laminatePricePerSheetValue = 0; 
                    appState.cuttingCost = 220; 
                    appState.roundedCornersCost = 0; 
                    appState.designCost = 0; 
                    appState.subtotal = 0;
                    appState.iva = 0;
                    appState.finalTotal = 0;
                    appState.unitPriceNoIva = 0; // Resetear el estado
                    updateSummary(); 
                    return;
                }
                errorMessageEl.classList.add('hidden');

                const cardsPerSheet = 20; 
                const sheetsNeeded = Math.ceil(quantity / cardsPerSheet);
                const paperCostPerSheetValue = currentPrices.paper[paper]; // Usar currentPrices
                const paperCostTotal = paperCostPerSheetValue * sheetsNeeded; 

                let printingCostPerSheet = 0; 
                if (printingSides === '1') {
                    printingCostPerSheet = getPrintingCostForSheets(printingFront, sheetsNeeded, '1-side');
                } else if (printingSides === '2') {
                    if (printingFront === printingBack) { 
                        printingCostPerSheet = getPrintingCostForSheets(printingFront, sheetsNeeded, '2-sides');
                    } else { 
                        const frontSideCostPerSheet = getPrintingCostForSheets(printingFront, sheetsNeeded, '1-side');
                        const backSideCostPerSheet = getPrintingCostForSheets(printingBack, sheetsNeeded, '1-side');
                        printingCostPerSheet = frontSideCostPerSheet + backSideCostPerSheet;
                    }
                }
                const totalPrintingCostForBatch = printingCostPerSheet * sheetsNeeded; 

                let totalFinishesCostForBatch = 0;
                let currentLaminateCost = 0;
                let laminatePricePerSheetFromTable = 0; 
                let currentRoundedCost = 0; 

                if (!noFinish) {
                    if (laminateSides && laminateType) {
                        laminatePricePerSheetFromTable = getLaminateCostForSheets(laminateType, sheetsNeeded, laminateSides === '1-side' ? '1-side' : '2-sides');
                        currentLaminateCost = laminatePricePerSheetFromTable * sheetsNeeded;
                        if (currentLaminateCost < 250 && currentLaminateCost > 0) {
                            currentLaminateCost = 250;
                        }
                        totalFinishesCostForBatch += currentLaminateCost;
                    }
                    if (roundedCorners) {
                        currentRoundedCost = currentPrices.finishes[roundedCorners]; // Usar currentPrices
                        totalFinishesCostForBatch += currentRoundedCost; 
                    }
                }

                const cuttingCost = appState.cuttingCost; 

                const designCost = currentPrices.design[designOption]; // Usar currentPrices

                const calculatedSubtotal = paperCostTotal + totalPrintingCostForBatch + totalFinishesCostForBatch + cuttingCost + designCost;
                const calculatedIva = calculatedSubtotal * 0.16;
                const calculatedFinalTotal = calculatedSubtotal + calculatedIva;
                const calculatedUnitPriceNoIva = calculatedSubtotal / quantity; // Calcular precio unitario sin IVA

                appState.sheetsNeeded = sheetsNeeded;
                appState.paperCostTotal = paperCostTotal;
                appState.paperCostPerSheetValue = paperCostPerSheetValue; 
                appState.printingCostPerSheet = printingCostPerSheet;
                appState.totalPrintingCostForBatch = totalPrintingCostForBatch; 
                appState.totalLaminateCost = currentLaminateCost; 
                appState.laminatePricePerSheetValue = laminatePricePerSheetFromTable; 
                appState.roundedCornersCost = currentRoundedCost; 
                appState.designCost = designCost; 
                appState.subtotal = calculatedSubtotal;
                appState.iva = calculatedIva;
                appState.finalTotal = calculatedFinalTotal;
                appState.unitPriceNoIva = calculatedUnitPriceNoIva; // Guardar el precio unitario sin IVA

                updateSummary(); 
            };
            
            const toggleBackPrintingOptions = () => {
                if (appState.printingSides === '2') {
                    backPrintingOptions.classList.remove('hidden');
                    if (!appState.printingBack) {
                        const defaultBackBtn = document.querySelector(`[data-type="printing-back"][data-value="color"]`);
                        defaultBackBtn.classList.add('active');
                        appState.printingBack = defaultBackBtn.dataset.value;
                    }
                } else {
                    backPrintingOptions.classList.add('hidden');
                    appState.printingBack = null;
                }
            };

            const deselectAllFinishes = () => {
                document.querySelectorAll('[data-type="laminate-sides"], [data-type="laminate-type"], [data-type="rounded-corners"]').forEach(btn => btn.classList.remove('active'));
                appState.laminateSides = null;
                appState.laminateType = null;
                appState.roundedCorners = null;
                appState.noFinish = true;
                noFinishButton.classList.add('active');

                appState.totalLaminateCost = 0;
                appState.laminatePricePerSheetValue = 0;
                appState.roundedCornersCost = 0;
            };

            const updateUIAndCalculate = () => {
                // Update input/select visual state
                if (quantityInput.value) {
                    quantityInput.classList.add('input-filled');
                } else {
                    quantityInput.classList.remove('input-filled');
                }
                if (paperSelect.value) {
                    paperSelect.classList.add('input-filled');
                } else {
                    paperSelect.classList.remove('input-filled');
                }

                updateSummary();
                calculateTotal();
            };

            // --- Manejadores de eventos ---
            
            paperSelect.addEventListener('change', () => {
                appState.paper = paperSelect.value;
                updateUIAndCalculate();
            });

            document.querySelectorAll('.selection-button').forEach(button => {
                button.addEventListener('click', () => {
                    const type = button.dataset.type;
                    const value = button.dataset.value;
                    
                    if (type === 'design-option') {
                        document.querySelectorAll(`[data-type="design-option"]`).forEach(btn => btn.classList.remove('active'));
                        button.classList.add('active');
                        appState.designOption = value;
                    } else if (type === 'no-finish') {
                        deselectAllFinishes();
                    } else if (type === 'laminate-sides' || type === 'laminate-type' || type === 'rounded-corners') {
                        appState.noFinish = false;
                        noFinishButton.classList.remove('active');

                        const isActive = button.classList.contains('active');

                        if (type === 'laminate-sides' || type === 'laminate-type') {
                            document.querySelectorAll(`[data-type="${type}"]`).forEach(btn => btn.classList.remove('active'));
                            if (!isActive) {
                                button.classList.add('active');
                                if (type === 'laminate-sides') appState.laminateSides = value;
                                if (type === 'laminate-type') appState.laminateType = value;
                            } else {
                                if (type === 'laminate-sides') appState.laminateSides = null;
                                if (type === 'laminate-type') appState.laminateType = null;
                            }
                        } else if (type === 'rounded-corners') {
                            document.querySelectorAll(`[data-type="${type}"]`).forEach(btn => btn.classList.remove('active'));
                             if (!isActive) {
                                button.classList.add('active');
                                appState.roundedCorners = value;
                            } else {
                                appState.roundedCorners = null;
                            }
                        }
                        if (!appState.laminateSides && !appState.laminateType && !appState.roundedCorners) {
                            appState.noFinish = true;
                            noFinishButton.classList.add('active');
                        }
                    } else { 
                        document.querySelectorAll(`[data-type="${type}"]`).forEach(btn => btn.classList.remove('active'));
                        button.classList.add('active');
                        
                        if (type === 'printing-sides') {
                            appState.printingSides = value;
                            toggleBackPrintingOptions();
                        } else if (type === 'printing-front') {
                            appState.printingFront = value;
                        } else if (type === 'printing-back') {
                            appState.printingBack = value;
                        }
                    }

                    updateUIAndCalculate();
                });
            });

            quantityInput.addEventListener('input', () => {
                appState.quantity = parseInt(quantityInput.value) || 0;
                updateUIAndCalculate();
            });

            resetButton.addEventListener('click', () => {
                quantityInput.value = '';
                paperSelect.value = ''; 
                
                document.querySelectorAll('.selection-button').forEach(btn => btn.classList.remove('active'));
                
                appState = {
                    quantity: 0,
                    paper: null,
                    printingSides: '1',
                    printingFront: 'color',
                    printingBack: null,
                    noFinish: true,
                    laminateSides: null,
                    laminateType: null,
                    roundedCorners: null,
                    designOption: 'client-sends', 
                    sheetsNeeded: 0,
                    paperCostTotal: 0,
                    paperCostPerSheetValue: 0,
                    printingCostPerSheet: 0,
                    totalPrintingCostForBatch: 0,
                    totalLaminateCost: 0,
                    laminatePricePerSheetValue: 0,
                    cuttingCost: 220,
                    roundedCornersCost: 0,
                    designCost: 0,
                    subtotal: 0,
                    iva: 0,
                    finalTotal: 0,
                    unitPriceNoIva: 0 // Resetear el estado
                };
                
                document.querySelector('[data-type="printing-sides"][data-value="1"]').classList.add('active');
                document.querySelector('[data-type="printing-front"][data-value="color"]').classList.add('active');
                document.querySelector('[data-type="design-option"][data-value="client-sends"]').classList.add('active'); 
                noFinishButton.classList.add('active');

                backPrintingOptions.classList.add('hidden');

                // Resetear los precios a los valores por defecto y guardarlos
                currentPrices = JSON.parse(JSON.stringify(defaultPrices));
                savePrices();
                populatePriceInputs(); // Actualizar los inputs de configuración

                updateUIAndCalculate();
            });

            themeToggleBtn.addEventListener('click', () => {
                document.body.classList.toggle('dark');
            });

            // --- Manejo de pestañas de configuración de precios ---
            configTabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const targetTab = button.dataset.tab;
                    const targetContent = document.getElementById(`${targetTab}-content`);

                    // Si la pestaña clicada ya está activa, desactívala (ocúltala)
                    if (button.classList.contains('active')) {
                        button.classList.remove('active');
                        targetContent.classList.remove('active');
                    } else {
                        // Remover 'active' de todos los botones y contenidos
                        configTabButtons.forEach(btn => btn.classList.remove('active'));
                        configContents.forEach(content => content.classList.remove('active'));

                        // Añadir 'active' al botón y contenido correctos
                        button.classList.add('active');
                        targetContent.classList.add('active');
                    }

                    // Rellenar los inputs cada vez que se cambia de pestaña (o se oculta)
                    populatePriceInputs();
                });
            });

            // Manejador de eventos para los inputs de precios de configuración
            priceInputs.forEach(input => {
                input.addEventListener('input', (event) => {
                    const category = event.target.dataset.category;
                    const item = event.target.dataset.item;
                    const type = event.target.dataset.type;
                    const rangeIdx = event.target.dataset.rangeIdx;
                    const sides = event.target.dataset.sides;
                    const value = parseFloat(event.target.value);

                    if (isNaN(value)) {
                        // Optionally handle invalid input, e.g., revert to last valid value or show error
                        return;
                    }

                    if (category === 'paper') {
                        currentPrices.paper[item] = value;
                    } else if (category === 'printing') {
                        currentPrices.printing[type][rangeIdx][sides] = value;
                    } else if (category === 'laminate') {
                        currentPrices.finishes.laminate[type][rangeIdx][sides] = value;
                    }
                    
                    savePrices(); // Guardar los precios modificados
                    updateUIAndCalculate(); // Recalcular con los nuevos precios
                });
            });
            
            // Inicialización de la aplicación
            loadPrices(); // Cargar precios al inicio
            populatePriceInputs(); // Rellenar los inputs de configuración al inicio
            document.querySelector('[data-type="printing-sides"][data-value="1"]').classList.add('active');
            document.querySelector('[data-type="printing-front"][data-value="color"]').classList.add('active');
            document.querySelector('[data-type="design-option"][data-value="client-sends"]').classList.add('active'); 
            noFinishButton.classList.add('active');
            updateUIAndCalculate();
        });
    </script>
</body>
</html>
