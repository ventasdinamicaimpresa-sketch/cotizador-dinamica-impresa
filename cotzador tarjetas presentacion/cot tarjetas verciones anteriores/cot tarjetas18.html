<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cotizador de Tarjetas de Presentación V3</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" xintegrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/inter-font@3.19.1/index.min.css" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        'primary': '#1A73E8',
                        'secondary': '#E8F0FE',
                        'dark-bg': '#121212',
                        'dark-card': '#1E1E1E',
                        'dark-text': '#E0E0E0',
                        'dark-input': '#333333',
                    },
                }
            }
        }
    </script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            transition: background-color 0.3s, color 0.3s;
        }

        .dark {
            background-color: #121212;
            color: #E0E0E0;
        }

        .dark .card {
            background-color: #1E1E1E;
            color: #E0E0E0;
        }

        .dark .form-input, .dark .form-select {
            background-color: #333333;
            color: #E0E0E0;
            border-color: #555555;
        }
        
        .dark .tab-button, .dark .selection-button {
            color: #E0E0E0;
            background-color: #333333;
        }

        .dark .selection-button.active, .dark .tab-button.active {
            background-color: #1A73E8;
            color: white;
            border-color: #1A73E8;
        }
        
        .dark .summary-box {
            background-color: #1E1E1E;
            border-color: #555555;
        }

        .selection-button {
            transition: all 0.2s ease-in-out;
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            border: 1px solid transparent;
        }
        
        .selection-button:hover:not(.active) {
            background-color: #e5e7eb;
            border-color: #d1d5db;
        }
        .dark .selection-button:hover:not(.active) {
            background-color: #2a2a2a;
            border-color: #4a4a4a;
        }

        .selection-button.active {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            border-color: #1A73E8;
        }

        .sub-options-container {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out, opacity 0.3s ease-out;
            opacity: 0;
        }
        .sub-options-container.active {
            max-height: 200px; /* Ajustar según la altura del contenido */
            transition: max-height 0.3s ease-in, opacity 0.3s ease-in;
            opacity: 1;
        }
    </style>
</head>
<body class="bg-gray-100 dark:bg-dark-bg p-4 flex items-center justify-center min-h-screen">

    <!-- Contenedor principal de la aplicación -->
    <div class="w-full max-w-7xl lg:flex lg:space-x-8">

        <!-- Formulario de cotización (izquierda) -->
        <div class="w-full lg:w-2/3 p-6 bg-white dark:bg-dark-card rounded-xl shadow-2xl space-y-8 md:p-10 mb-8 lg:mb-0">
            <!-- Encabezado y botón para alternar modo oscuro -->
            <div class="flex justify-between items-center mb-6">
                <h1 class="text-3xl sm:text-4xl font-bold text-gray-900 dark:text-dark-text">Cotizador de Tarjetas</h1>
                <button id="theme-toggle" class="p-2 rounded-full bg-gray-200 dark:bg-dark-input text-gray-800 dark:text-gray-200 transition-colors duration-300">
                    <i class="fas fa-moon dark:hidden"></i>
                    <i class="fas fa-sun hidden dark:inline"></i>
                </button>
            </div>

            <form id="quote-form" class="space-y-6">
                <!-- Cantidad -->
                <div>
                    <label for="quantity" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Cantidad</label>
                    <input type="number" id="quantity" name="quantity" class="form-input w-full p-3 rounded-lg border-gray-300 dark:border-gray-600 focus:ring-primary focus:border-primary dark:bg-dark-input dark:text-dark-text transition-colors duration-300" min="1" placeholder="Ej. 1000">
                </div>

                <!-- Tipo de Papel (Menú desplegable) -->
                <div>
                    <label for="paper-select" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Tipo de Papel</label>
                    <select id="paper-select" name="paper-select" class="form-select w-full p-3 rounded-lg border-gray-300 dark:border-gray-600 focus:ring-primary focus:border-primary dark:bg-dark-input dark:text-dark-text transition-colors duration-300">
                        <option value="" disabled selected>Selecciona un tipo de papel</option>
                        <option value="opaline-white-225">Cartulina Opalina Blanca 225g</option>
                        <option value="opaline-ivory-225">Cartulina Opalina Marfil 225g</option>
                        <option value="couche-300">Couche 300g</option>
                        <option value="couche-250">Couche 250g</option>
                        <option value="sulfated-12pt">Cartulina Sulfatada 12pt</option>
                        <option value="kromakote">Cartulina Kromakote</option>
                        <option value="stardream">Cartulina Stardream</option>
                    </select>
                </div>

                <!-- Lados de Impresión -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Lados de Impresión</label>
                    <div class="flex gap-4">
                        <button type="button" class="selection-button py-3 px-4 rounded-lg bg-gray-50 dark:bg-dark-input text-sm font-medium text-gray-700 dark:text-gray-300 active" data-type="printing-sides" data-value="1">1 Lado</button>
                        <button type="button" class="selection-button py-3 px-4 rounded-lg bg-gray-50 dark:bg-dark-input text-sm font-medium text-gray-700 dark:text-gray-300" data-type="printing-sides" data-value="2">2 Lados</button>
                    </div>
                </div>
                
                <!-- Opciones de impresión (Frente y Reverso) -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Frente -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Impresión (Frente)</label>
                        <div class="flex gap-4">
                            <button type="button" class="selection-button py-3 px-4 rounded-lg bg-gray-50 dark:bg-dark-input text-sm font-medium text-gray-700 dark:text-gray-300 active" data-type="printing-front" data-value="color">Color</button>
                            <button type="button" class="selection-button py-3 px-4 rounded-lg bg-gray-50 dark:bg-dark-input text-sm font-medium text-gray-700 dark:text-gray-300" data-type="printing-front" data-value="bw">Blanco y Negro</button>
                        </div>
                    </div>
                    <!-- Reverso (se muestra solo si se elige 2 lados) -->
                    <div id="back-printing-options" class="hidden">
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Impresión (Reverso)</label>
                        <div class="flex gap-4">
                            <button type="button" class="selection-button py-3 px-4 rounded-lg bg-gray-50 dark:bg-dark-input text-sm font-medium text-gray-700 dark:text-gray-300" data-type="printing-back" data-value="color">Color</button>
                            <button type="button" class="selection-button py-3 px-4 rounded-lg bg-gray-50 dark:bg-dark-input text-sm font-medium text-gray-700 dark:text-gray-300" data-type="printing-back" data-value="bw">Blanco y Negro</button>
                        </div>
                    </div>
                </div>

                <!-- Acabados -->
                <div class="space-y-6">
                    <label class="block text-lg font-bold text-gray-900 dark:text-dark-text mb-2">Acabados</label>
                    
                    <!-- Opción Sin Acabados -->
                    <div class="p-4 rounded-lg bg-gray-100 dark:bg-dark-input">
                        <button type="button" class="selection-button w-full py-3 px-4 rounded-lg bg-gray-50 dark:bg-dark-input text-sm font-medium text-gray-700 dark:text-gray-300 active" data-type="no-finish" data-value="no-finish">Sin Acabados</button>
                    </div>

                    <!-- Sección de Laminado -->
                    <div id="laminate-options" class="p-4 rounded-lg bg-gray-100 dark:bg-dark-input space-y-4">
                        <h4 class="text-md font-semibold text-gray-700 dark:text-gray-300">Laminado</h4>
                        <div>
                            <label class="block text-sm font-medium text-gray-600 dark:text-gray-400 mb-1">Lados</label>
                            <div class="flex gap-4">
                                <button type="button" class="selection-button py-2 px-3 rounded-lg bg-gray-50 dark:bg-dark-input text-xs font-medium text-gray-700 dark:text-gray-300" data-type="laminate-sides" data-value="1-side">1 Lado</button>
                                <button type="button" class="selection-button py-2 px-3 rounded-lg bg-gray-50 dark:bg-dark-input text-xs font-medium text-gray-700 dark:text-gray-300" data-type="laminate-sides" data-value="2-sides">2 Lados</button>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-600 dark:text-gray-400 mb-1">Tipo de Acabado</label>
                            <div class="flex gap-4">
                                <button type="button" class="selection-button py-2 px-3 rounded-lg bg-gray-50 dark:bg-dark-input text-xs font-medium text-gray-700 dark:text-gray-300" data-type="laminate-type" data-value="matte">Mate</button>
                                <button type="button" class="selection-button py-2 px-3 rounded-lg bg-gray-50 dark:bg-dark-input text-xs font-medium text-gray-700 dark:text-gray-300" data-type="laminate-type" data-value="glossy">Brillante</button>
                            </div>
                        </div>
                    </div>

                    <!-- Sección de Redondeo de esquinas -->
                    <div id="rounded-options" class="p-4 rounded-lg bg-gray-100 dark:bg-dark-input space-y-4">
                        <h4 class="text-md font-semibold text-gray-700 dark:text-gray-300">Redondeo de esquinas</h4>
                        <div class="flex gap-4">
                            <button type="button" class="selection-button py-2 px-3 rounded-lg bg-gray-50 dark:bg-dark-input text-xs font-medium text-gray-700 dark:text-gray-300" data-type="rounded-corners" data-value="rounded-1">1 Esquina</button>
                            <button type="button" class="selection-button py-2 px-3 rounded-lg bg-gray-50 dark:bg-dark-input text-xs font-medium text-gray-700 dark:text-gray-300" data-type="rounded-corners" data-value="rounded-2">2 Esquinas</button>
                            <button type="button" class="selection-button py-2 px-3 rounded-lg bg-gray-50 dark:bg-dark-input text-xs font-medium text-gray-700 dark:text-gray-300" data-type="rounded-corners" data-value="rounded-4">4 Esquinas</button>
                        </div>
                    </div>
                </div>

                <!-- Botones de acción -->
                <div class="flex flex-col sm:flex-row justify-center gap-4 mt-8">
                    <button type="button" id="reset-btn" class="w-full sm:w-auto px-6 py-3 rounded-lg font-bold bg-gray-200 dark:bg-dark-input hover:bg-gray-300 dark:hover:bg-gray-700 text-gray-800 dark:text-gray-200 transition-colors duration-300">
                        <i class="fas fa-sync-alt mr-2"></i> Limpiar Campos
                    </button>
                </div>
            </form>
        </div>

        <!-- Resumen de cotización (derecha) -->
        <div class="w-full lg:w-1/3 p-6 bg-secondary dark:bg-dark-card rounded-xl shadow-lg summary-box">
            <h2 class="text-xl font-bold text-gray-900 dark:text-dark-text mb-4">Resumen de Cotización</h2>
            <div id="summary-content" class="text-gray-700 dark:text-gray-300 space-y-4">
                <p><strong>Cantidad:</strong> <span id="summary-quantity">--</span></p>
                <p><strong>Papel:</strong> <span id="summary-paper">--</span></p>
                <p><strong>Impresión:</strong> <span id="summary-printing">--</span></p>
                <p><strong>Acabados:</strong> <span id="summary-finishes">--</span></p>
            </div>
            
            <div class="mt-8 pt-4 border-t border-gray-300 dark:border-gray-600">
                <p class="text-lg font-semibold text-gray-900 dark:text-dark-text">Costo Total:</p>
                <p id="total-cost" class="text-4xl font-extrabold text-primary dark:text-white">$0.00</p>
                <p id="error-message" class="text-red-500 text-sm mt-2 hidden">Por favor, completa todos los campos para calcular el costo.</p>
            </div>
        </div>
    </div>

    <!-- Script de la aplicación -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Mapeo de precios
            const prices = {
                paper: {
                    'opaline-white-225': 500,
                    'opaline-ivory-225': 550,
                    'couche-300': 600,
                    'couche-250': 580,
                    'sulfated-12pt': 650,
                    'kromakote': 700,
                    'stardream': 800,
                },
                printing: {
                    'front-color': 0.25,
                    'front-bw': 0.15,
                    'back-color': 0.25,
                    'back-bw': 0.15,
                },
                finishes: {
                    'no-finish': 0,
                    'laminate-1-side-matte': 0.20,
                    'laminate-1-side-glossy': 0.22,
                    'laminate-2-sides-matte': 0.35,
                    'laminate-2-sides-glossy': 0.38,
                    'rounded-1': 0.05,
                    'rounded-2': 0.10,
                    'rounded-4': 0.15,
                }
            };
            
            // Estado global de la aplicación para gestionar las selecciones
            let appState = {
                quantity: 0,
                paper: null,
                printingSides: '1',
                printingFront: 'color',
                printingBack: null,
                // Acabados ahora tienen un estado independiente
                noFinish: true,
                laminateSides: null,
                laminateType: null,
                roundedCorners: null,
            };

            // Elementos del DOM
            const quantityInput = document.getElementById('quantity');
            const paperSelect = document.getElementById('paper-select');
            const noFinishButton = document.querySelector('[data-type="no-finish"]');
            const selectionButtons = document.querySelectorAll('.selection-button:not([data-type="no-finish"])');
            const backPrintingOptions = document.getElementById('back-printing-options');
            const totalCostEl = document.getElementById('total-cost');
            const errorMessageEl = document.getElementById('error-message');
            const resetButton = document.getElementById('reset-btn');
            const themeToggleBtn = document.getElementById('theme-toggle');

            // --- Funciones de control de UI y lógica de cálculo ---

            // Función para actualizar el resumen de selecciones en la UI
            const updateSummary = () => {
                document.getElementById('summary-quantity').textContent = appState.quantity || '--';
                
                // Actualizar resumen de papel usando el texto del menú desplegable
                const selectedPaperOption = paperSelect.options[paperSelect.selectedIndex];
                document.getElementById('summary-paper').textContent = selectedPaperOption.value ? selectedPaperOption.text : '--';
                
                // Actualizar resumen de impresión
                let printingText = 'No seleccionado';
                if (appState.printingFront) {
                    const frontLabel = document.querySelector(`[data-type="printing-front"][data-value="${appState.printingFront}"]`).textContent.trim();
                    printingText = `Frente: ${frontLabel}`;
                    if (appState.printingSides === '2' && appState.printingBack) {
                        const backLabel = document.querySelector(`[data-type="printing-back"][data-value="${appState.printingBack}"]`).textContent.trim();
                        printingText += `, Reverso: ${backLabel}`;
                    }
                }
                document.getElementById('summary-printing').textContent = printingText;
                
                // Actualizar resumen de acabados
                let finishesText = '';
                let finishesList = [];

                if (appState.noFinish) {
                    finishesList.push('Sin acabados');
                } else {
                    if (appState.laminateSides && appState.laminateType) {
                        const sidesLabel = document.querySelector(`[data-type="laminate-sides"][data-value="${appState.laminateSides}"]`).textContent.trim();
                        const typeLabel = document.querySelector(`[data-type="laminate-type"][data-value="${appState.laminateType}"]`).textContent.trim();
                        finishesList.push(`Laminado: ${sidesLabel}, ${typeLabel}`);
                    }
                    if (appState.roundedCorners) {
                        const roundedLabel = document.querySelector(`[data-type="rounded-corners"][data-value="${appState.roundedCorners}"]`).textContent.trim();
                        finishesList.push(`Redondeo: ${roundedLabel}`);
                    }
                }

                finishesText = finishesList.length > 0 ? finishesList.join(', ') : '--';
                document.getElementById('summary-finishes').textContent = finishesText;
            };

            // Función principal para calcular el costo total
            const calculateTotal = () => {
                const { quantity, paper, printingSides, printingFront, printingBack, noFinish, laminateSides, laminateType, roundedCorners } = appState;

                // Validación para mostrar u ocultar el error
                if (quantity <= 0 || !paper || !printingFront || (printingSides === '2' && !printingBack)) {
                    totalCostEl.textContent = '$0.00';
                    errorMessageEl.classList.remove('hidden');
                    return;
                }
                errorMessageEl.classList.add('hidden');

                // Cálculo de costos
                const paperCost = (prices.paper[paper] / 1000) * quantity;
                const printingCostFront = prices.printing[`front-${printingFront}`] * quantity;
                const printingCostBack = (printingSides === '2' && printingBack) ? prices.printing[`back-${printingBack}`] * quantity : 0;
                let finishesCost = 0;

                if (!noFinish) {
                    if (laminateSides && laminateType) {
                        const finishKey = `laminate-${laminateSides}-${laminateType}`;
                        finishesCost += prices.finishes[finishKey] * quantity;
                    }
                    if (roundedCorners) {
                        finishesCost += prices.finishes[roundedCorners] * quantity;
                    }
                }

                const total = paperCost + printingCostFront + printingCostBack + finishesCost;
                totalCostEl.textContent = `$${total.toFixed(2)}`;
            };
            
            // Función para alternar la visibilidad de las opciones de impresión del reverso
            const toggleBackPrintingOptions = () => {
                if (appState.printingSides === '2') {
                    backPrintingOptions.classList.remove('hidden');
                    // Seleccionar una opción por defecto si no hay ninguna
                    if (!appState.printingBack) {
                        const defaultBackBtn = document.querySelector(`[data-type="printing-back"][data-value="color"]`);
                        defaultBackBtn.classList.add('active');
                        appState.printingBack = defaultBackBtn.dataset.value;
                    }
                } else {
                    backPrintingOptions.classList.add('hidden');
                    appState.printingBack = null;
                }
            };

            // Función para deseleccionar todos los acabados
            const deselectAllFinishes = () => {
                document.querySelectorAll('[data-type="laminate-sides"], [data-type="laminate-type"], [data-type="rounded-corners"]').forEach(btn => btn.classList.remove('active'));
                appState.laminateSides = null;
                appState.laminateType = null;
                appState.roundedCorners = null;
                appState.noFinish = true;
                noFinishButton.classList.add('active');
            };

            // Función para alternar la selección de acabados
            const handleFinishSelection = (type, value) => {
                // Deseleccionar "Sin Acabados" si se elige cualquier otro acabado
                if (type !== 'no-finish') {
                    appState.noFinish = false;
                    noFinishButton.classList.remove('active');
                }

                if (type === 'laminate-sides') {
                    appState.laminateSides = value;
                } else if (type === 'laminate-type') {
                    appState.laminateType = value;
                } else if (type === 'rounded-corners') {
                    // Permitir deseleccionar un acabado
                    if (appState.roundedCorners === value) {
                        appState.roundedCorners = null;
                        document.querySelector(`[data-type="rounded-corners"][data-value="${value}"]`).classList.remove('active');
                    } else {
                        // Deseleccionar otras opciones del mismo tipo
                        document.querySelectorAll(`[data-type="${type}"]`).forEach(btn => btn.classList.remove('active'));
                        appState.roundedCorners = value;
                        document.querySelector(`[data-type="rounded-corners"][data-value="${value}"]`).classList.add('active');
                    }
                }

                // Si no hay ningún acabado seleccionado, marcar "Sin Acabados"
                if (!appState.laminateSides && !appState.laminateType && !appState.roundedCorners) {
                    appState.noFinish = true;
                    noFinishButton.classList.add('active');
                }
            };

            // Función principal que se llama en cada cambio para actualizar todo
            const updateUIAndCalculate = () => {
                updateSummary();
                calculateTotal();
            };

            // --- Manejadores de eventos ---
            
            // Manejador para el menú desplegable de papel
            paperSelect.addEventListener('change', () => {
                appState.paper = paperSelect.value;
                updateUIAndCalculate();
            });

            // Manejador para los botones de selección general (impresión, etc.) y los acabados
            selectionButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const type = button.dataset.type;
                    const value = button.dataset.value;
                    
                    // Desactivar todos los botones del mismo tipo (excepto para acabados donde pueden ser múltiples)
                    if (type !== 'laminate-sides' && type !== 'laminate-type' && type !== 'rounded-corners') {
                        document.querySelectorAll(`[data-type="${type}"]`).forEach(btn => btn.classList.remove('active'));
                    }
                    
                    // Toggle el estado del botón actual
                    button.classList.toggle('active');
                    
                    // Actualizar el estado de la aplicación
                    if (type === 'printing-sides') {
                        appState.printingSides = value;
                        toggleBackPrintingOptions();
                    } else if (type === 'printing-front') {
                        appState.printingFront = value;
                    } else if (type === 'printing-back') {
                        appState.printingBack = value;
                    } else if (type === 'laminate-sides' || type === 'laminate-type' || type === 'rounded-corners') {
                         handleFinishSelection(type, value);
                    }
                    
                    updateUIAndCalculate();
                });
            });

            // Manejador para el botón de "Sin Acabados"
            noFinishButton.addEventListener('click', () => {
                deselectAllFinishes();
                updateUIAndCalculate();
            });

            // Manejador para la cantidad (se activa al escribir o cambiar el valor)
            quantityInput.addEventListener('input', () => {
                appState.quantity = parseInt(quantityInput.value) || 0;
                updateUIAndCalculate();
            });

            // Manejador para el botón de limpiar
            resetButton.addEventListener('click', () => {
                quantityInput.value = '';
                paperSelect.value = ''; // Resetear el dropdown
                
                selectionButtons.forEach(btn => btn.classList.remove('active'));
                
                // Reiniciar el estado a los valores por defecto
                appState = {
                    quantity: 0,
                    paper: null,
                    printingSides: '1',
                    printingFront: 'color',
                    printingBack: null,
                    noFinish: true,
                    laminateSides: null,
                    laminateType: null,
                    roundedCorners: null,
                };
                
                // Activar los botones por defecto en la UI
                document.querySelector('[data-type="printing-sides"][data-value="1"]').classList.add('active');
                document.querySelector('[data-type="printing-front"][data-value="color"]').classList.add('active');
                noFinishButton.classList.add('active');

                // Ocultar las opciones condicionales
                backPrintingOptions.classList.add('hidden');

                // Actualizar la UI
                updateUIAndCalculate();
            });

            // Manejador de eventos para el botón de alternar tema
            themeToggleBtn.addEventListener('click', () => {
                document.body.classList.toggle('dark');
            });
            
            // Inicialización de la aplicación
            // Seleccionar los botones por defecto al cargar
            document.querySelector('[data-type="printing-sides"][data-value="1"]').classList.add('active');
            document.querySelector('[data-type="printing-front"][data-value="color"]').classList.add('active');
            noFinishButton.classList.add('active');
            updateUIAndCalculate();
        });
    </script>
</body>
</html>
